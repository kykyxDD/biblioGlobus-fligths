function interpolate(e,n){return e.replace(/#\{([^}]+)}/g,function(e,t){return n[t]||""})}function not(t){return function(e){return!t(e)}}function property(t){return function(e){return e[t]}}function method(t){return function(e){return e[t]()}}function numeric(n){return function(e,t){return e[n]-t[n]}}function make(n){return function(e,t){return new n(e,t)}}function bytes(e){var t=+e.toExponential().split("e")[1]/3|0;return hround(e/(1<<10*t))+" KMGT"[t]}function add_class(e,t){has_class(e,t)||(e.className+=" "+t)}function rem_class(e,t){e.className=e.className.replace(t,"").replace(/\s+/g," ")}function has_class(e,t){return~e.className.indexOf(t)}function min(e){return Math.min.apply(0,e)}function max(e){return Math.max.apply(0,e)}function rand(e){return Math.random()*(+e||1)|0}function hround(e){return(100*e+.5|0)/100}function hash(o){return String.fromCharCode.apply(0,(o+"").split("").map(function(e){return e.charCodeAt()}).map(function(e,t,n){return o=33+((Math.abs(n.slice(t).concat(n.slice(0,t)).reduce(function(e,t,n){return e+t/++n*(n%2?-1:1)},e))^o)%94|0)}))}!function(m,g){var v=Math,o=g.createElement("div").style,i=function(){for(var e="t,webkitT,MozT,msT,OT".split(","),t=0,n=e.length;t<n;t++)if(e[t]+"ransform"in o)return e[t].substr(0,e[t].length-1);return!1}(),r=i?"-"+i.toLowerCase()+"-":"",b=n("transform"),a=n("transitionProperty"),y=n("transitionDuration"),s=n("transformOrigin"),l=n("transitionTimingFunction"),c=n("transitionDelay"),u=/android/gi.test(navigator.appVersion),p=/iphone|ipad/gi.test(navigator.appVersion),e=/hp-tablet/gi.test(navigator.appVersion),d=n("perspective")in o,w="ontouchstart"in m&&!e,f=!!i,h=n("transition")in o,x="onorientationchange"in m?"orientationchange":"resize",S=w?"touchstart":"mousedown",_=w?"touchmove":"mousemove",k=w?"touchend":"mouseup",T=w?"touchcancel":"mouseup",E="Moz"==i?"DOMMouseScroll":"mousewheel",C=function(){if(!1===i)return!1;return{"":"transitionend",webkit:"webkitTransitionEnd",Moz:"transitionend",O:"oTransitionEnd",ms:"MSTransitionEnd"}[i]}(),A=m.requestAnimationFrame||m.webkitRequestAnimationFrame||m.mozRequestAnimationFrame||m.oRequestAnimationFrame||m.msRequestAnimationFrame||function(e){return setTimeout(e,1)},D=m.cancelRequestAnimationFrame||m.webkitCancelAnimationFrame||m.webkitCancelRequestAnimationFrame||m.mozCancelRequestAnimationFrame||m.oCancelRequestAnimationFrame||m.msCancelRequestAnimationFrame||clearTimeout,z=d?" translateZ(0)":"",t=function(e,t){var n,o=this;for(n in o.wrapper="object"==typeof e?e:g.getElementById(e),o.wrapper.style.overflow="hidden",o.scroller=o.wrapper.children[0],o.options={hScroll:!0,vScroll:!0,x:0,y:0,bounce:!0,bounceLock:!1,momentum:!0,lockDirection:!0,useTransform:!0,useTransition:!1,topOffset:0,checkDOMChanges:!1,handleClick:!0,hScrollbar:!0,vScrollbar:!0,fixedScrollbar:u,hideScrollbar:p,fadeScrollbar:p&&d,scrollbarClass:"",zoom:!1,zoomMin:1,zoomMax:4,doubleTapZoom:2,wheelAction:"scroll",snap:!1,snapThreshold:1,onRefresh:null,onBeforeScrollStart:function(e){e.preventDefault()},onScrollStart:null,onBeforeScrollMove:null,onScrollMove:null,onBeforeScrollEnd:null,onScrollEnd:null,onTouchEnd:null,onDestroy:null,onZoomStart:null,onZoom:null,onZoomEnd:null},t)o.options[n]=t[n];o.x=o.options.x,o.y=o.options.y,o.options.useTransform=f&&o.options.useTransform,o.options.hScrollbar=o.options.hScroll&&o.options.hScrollbar,o.options.vScrollbar=o.options.vScroll&&o.options.vScrollbar,o.options.zoom=o.options.useTransform&&o.options.zoom,o.options.useTransition=h&&o.options.useTransition,o.options.zoom&&u&&(z=""),o.scroller.style[a]=o.options.useTransform?r+"transform":"top left",o.scroller.style[y]="0",o.scroller.style[s]="0 0",o.options.useTransition&&(o.scroller.style[l]="cubic-bezier(0.33,0.66,0.66,1)"),o.options.useTransform?o.scroller.style[b]="translate("+o.x+"px,"+o.y+"px)"+z:o.scroller.style.cssText+=";position:absolute;top:"+o.y+"px;left:"+o.x+"px",o.options.useTransition&&(o.options.fixedScrollbar=!0),o.refresh(),o._bind(x,m),o._bind(S),w||"none"!=o.options.wheelAction&&o._bind(E),o.options.checkDOMChanges&&(o.checkDOMTime=setInterval(function(){o._checkDOMChanges()},500))};function n(e){return""===i?e:(e=e.charAt(0).toUpperCase()+e.substr(1),i+e)}t.prototype={enabled:!0,x:0,y:0,steps:[],scale:1,currPageX:0,currPageY:0,pagesX:[],pagesY:[],aniTime:null,wheelZoomCount:0,handleEvent:function(e){var t=this;switch(e.type){case S:if(!w&&0!==e.button)return;t._start(e);break;case _:t._move(e);break;case k:case T:t._end(e);break;case x:t._resize();break;case E:t._wheel(e);break;case C:t._transitionEnd(e)}},_checkDOMChanges:function(){this.moved||this.zoomed||this.animating||this.scrollerW==this.scroller.offsetWidth*this.scale&&this.scrollerH==this.scroller.offsetHeight*this.scale||this.refresh()},_scrollbar:function(e){var t,n=this;n[e+"Scrollbar"]?(n[e+"ScrollbarWrapper"]||(t=g.createElement("div"),n.options.scrollbarClass?t.className=n.options.scrollbarClass+e.toUpperCase():t.style.cssText="position:absolute;z-index:100;"+("h"==e?"height:7px;bottom:1px;left:2px;right:"+(n.vScrollbar?"7":"2")+"px":"width:7px;bottom:"+(n.hScrollbar?"7":"2")+"px;top:2px;right:1px"),t.style.cssText+=";pointer-events:none;"+r+"transition-property:opacity;"+r+"transition-duration:"+(n.options.fadeScrollbar?"350ms":"0")+";overflow:hidden;opacity:"+(n.options.hideScrollbar?"0":"1"),n.wrapper.appendChild(t),n[e+"ScrollbarWrapper"]=t,t=g.createElement("div"),n.options.scrollbarClass||(t.style.cssText="position:absolute;z-index:100;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.9);"+r+"background-clip:padding-box;"+r+"box-sizing:border-box;"+("h"==e?"height:100%":"width:100%")+";"+r+"border-radius:3px;border-radius:3px"),t.style.cssText+=";pointer-events:none;"+r+"transition-property:"+r+"transform;"+r+"transition-timing-function:cubic-bezier(0.33,0.66,0.66,1);"+r+"transition-duration:0;"+r+"transform: translate(0,0)"+z,n.options.useTransition&&(t.style.cssText+=";"+r+"transition-timing-function:cubic-bezier(0.33,0.66,0.66,1)"),n[e+"ScrollbarWrapper"].appendChild(t),n[e+"ScrollbarIndicator"]=t),"h"==e?(n.hScrollbarSize=n.hScrollbarWrapper.clientWidth,n.hScrollbarIndicatorSize=v.max(v.round(n.hScrollbarSize*n.hScrollbarSize/n.scrollerW),8),n.hScrollbarIndicator.style.width=n.hScrollbarIndicatorSize+"px",n.hScrollbarMaxScroll=n.hScrollbarSize-n.hScrollbarIndicatorSize,n.hScrollbarProp=n.hScrollbarMaxScroll/n.maxScrollX):(n.vScrollbarSize=n.vScrollbarWrapper.clientHeight,n.vScrollbarIndicatorSize=v.max(v.round(n.vScrollbarSize*n.vScrollbarSize/n.scrollerH),8),n.vScrollbarIndicator.style.height=n.vScrollbarIndicatorSize+"px",n.vScrollbarMaxScroll=n.vScrollbarSize-n.vScrollbarIndicatorSize,n.vScrollbarProp=n.vScrollbarMaxScroll/n.maxScrollY),n._scrollbarPos(e,!0)):n[e+"ScrollbarWrapper"]&&(f&&(n[e+"ScrollbarIndicator"].style[b]=""),n[e+"ScrollbarWrapper"].parentNode.removeChild(n[e+"ScrollbarWrapper"]),n[e+"ScrollbarWrapper"]=null,n[e+"ScrollbarIndicator"]=null)},_resize:function(){var e=this;setTimeout(function(){e.refresh()},u?200:0)},_pos:function(e,t){this.zoomed||(e=this.hScroll?e:0,t=this.vScroll?t:0,this.options.useTransform?this.scroller.style[b]="translate("+e+"px,"+t+"px) scale("+this.scale+")"+z:(e=v.round(e),t=v.round(t),this.scroller.style.left=e+"px",this.scroller.style.top=t+"px"),this.x=e,this.y=t,this._scrollbarPos("h"),this._scrollbarPos("v"))},_scrollbarPos:function(e,t){var n,o=this,i="h"==e?o.x:o.y;o[e+"Scrollbar"]&&((i=o[e+"ScrollbarProp"]*i)<0?(o.options.fixedScrollbar||((n=o[e+"ScrollbarIndicatorSize"]+v.round(3*i))<8&&(n=8),o[e+"ScrollbarIndicator"].style["h"==e?"width":"height"]=n+"px"),i=0):i>o[e+"ScrollbarMaxScroll"]&&(o.options.fixedScrollbar?i=o[e+"ScrollbarMaxScroll"]:((n=o[e+"ScrollbarIndicatorSize"]-v.round(3*(i-o[e+"ScrollbarMaxScroll"])))<8&&(n=8),o[e+"ScrollbarIndicator"].style["h"==e?"width":"height"]=n+"px",i=o[e+"ScrollbarMaxScroll"]+(o[e+"ScrollbarIndicatorSize"]-n))),o[e+"ScrollbarWrapper"].style[c]="0",o[e+"ScrollbarWrapper"].style.opacity=t&&o.options.hideScrollbar?"0":"1",o[e+"ScrollbarIndicator"].style[b]="translate("+("h"==e?i+"px,0)":"0,"+i+"px)")+z)},_start:function(e){var t,n,o,i,r,a=this,s=w?e.touches[0]:e;a.enabled&&(a.options.onBeforeScrollStart&&a.options.onBeforeScrollStart.call(a,e),(a.options.useTransition||a.options.zoom)&&a._transitionTime(0),a.moved=!1,a.animating=!1,a.zoomed=!1,a.distX=0,a.distY=0,a.absDistX=0,a.absDistY=0,a.dirX=0,a.dirY=0,a.options.zoom&&w&&1<e.touches.length&&(i=v.abs(e.touches[0].pageX-e.touches[1].pageX),r=v.abs(e.touches[0].pageY-e.touches[1].pageY),a.touchesDistStart=v.sqrt(i*i+r*r),a.originX=v.abs(e.touches[0].pageX+e.touches[1].pageX-2*a.wrapperOffsetLeft)/2-a.x,a.originY=v.abs(e.touches[0].pageY+e.touches[1].pageY-2*a.wrapperOffsetTop)/2-a.y,a.options.onZoomStart&&a.options.onZoomStart.call(a,e)),a.options.momentum&&(a.options.useTransform?(n=1*(t=getComputedStyle(a.scroller,null)[b].replace(/[^0-9\-.,]/g,"").split(","))[4],o=1*t[5]):(n=1*getComputedStyle(a.scroller,null).left.replace(/[^0-9-]/g,""),o=1*getComputedStyle(a.scroller,null).top.replace(/[^0-9-]/g,"")),n==a.x&&o==a.y||(a.options.useTransition?a._unbind(C):D(a.aniTime),a.steps=[],a._pos(n,o))),a.absStartX=a.x,a.absStartY=a.y,a.startX=a.x,a.startY=a.y,a.pointX=s.pageX,a.pointY=s.pageY,a.startTime=e.timeStamp||Date.now(),a.options.onScrollStart&&a.options.onScrollStart.call(a,e),a._bind(_,m),a._bind(k,m),a._bind(T,m))},_move:function(e){var t,n,o,i=this,r=w?e.touches[0]:e,a=r.pageX-i.pointX,s=r.pageY-i.pointY,l=i.x+a,c=i.y+s,u=e.timeStamp||Date.now();if(i.options.onBeforeScrollMove&&i.options.onBeforeScrollMove.call(i,e),i.options.zoom&&w&&1<e.touches.length)return t=v.abs(e.touches[0].pageX-e.touches[1].pageX),n=v.abs(e.touches[0].pageY-e.touches[1].pageY),i.touchesDist=v.sqrt(t*t+n*n),i.zoomed=!0,(o=1/i.touchesDistStart*i.touchesDist*this.scale)<i.options.zoomMin?o=.5*i.options.zoomMin*Math.pow(2,o/i.options.zoomMin):o>i.options.zoomMax&&(o=2*i.options.zoomMax*Math.pow(.5,i.options.zoomMax/o)),i.lastScale=o/this.scale,l=this.originX-this.originX*i.lastScale+this.x,c=this.originY-this.originY*i.lastScale+this.y,this.scroller.style[b]="translate("+l+"px,"+c+"px) scale("+o+")"+z,void(i.options.onZoom&&i.options.onZoom.call(i,e));i.pointX=r.pageX,i.pointY=r.pageY,(0<l||l<i.maxScrollX)&&(l=i.options.bounce?i.x+a/2:0<=l||0<=i.maxScrollX?0:i.maxScrollX),(c>i.minScrollY||c<i.maxScrollY)&&(c=i.options.bounce?i.y+s/2:c>=i.minScrollY||0<=i.maxScrollY?i.minScrollY:i.maxScrollY),i.distX+=a,i.distY+=s,i.absDistX=v.abs(i.distX),i.absDistY=v.abs(i.distY),i.absDistX<6&&i.absDistY<6||(i.options.lockDirection&&(i.absDistX>i.absDistY+5?(c=i.y,s=0):i.absDistY>i.absDistX+5&&(l=i.x,a=0)),i.moved=!0,i._pos(l,c),i.dirX=0<a?-1:a<0?1:0,i.dirY=0<s?-1:s<0?1:0,300<u-i.startTime&&(i.startTime=u,i.startX=i.x,i.startY=i.y),i.options.onScrollMove&&i.options.onScrollMove.call(i,e))},_end:function(e){if(!w||0===e.touches.length){var t,n,o,i,r,a,s,l=this,c=w?e.changedTouches[0]:e,u={dist:0,time:0},p={dist:0,time:0},d=(e.timeStamp||Date.now())-l.startTime,f=l.x,h=l.y;if(l._unbind(_,m),l._unbind(k,m),l._unbind(T,m),l.options.onBeforeScrollEnd&&l.options.onBeforeScrollEnd.call(l,e),l.zoomed)return s=l.scale*l.lastScale,s=Math.max(l.options.zoomMin,s),s=Math.min(l.options.zoomMax,s),l.lastScale=s/l.scale,l.scale=s,l.x=l.originX-l.originX*l.lastScale+l.x,l.y=l.originY-l.originY*l.lastScale+l.y,l.scroller.style[y]="200ms",l.scroller.style[b]="translate("+l.x+"px,"+l.y+"px) scale("+l.scale+")"+z,l.zoomed=!1,l.refresh(),void(l.options.onZoomEnd&&l.options.onZoomEnd.call(l,e));if(!l.moved)return w&&(l.doubleTapTimer&&l.options.zoom?(clearTimeout(l.doubleTapTimer),l.doubleTapTimer=null,l.options.onZoomStart&&l.options.onZoomStart.call(l,e),l.zoom(l.pointX,l.pointY,1==l.scale?l.options.doubleTapZoom:1),l.options.onZoomEnd&&setTimeout(function(){l.options.onZoomEnd.call(l,e)},200)):this.options.handleClick&&(l.doubleTapTimer=setTimeout(function(){for(l.doubleTapTimer=null,t=c.target;1!=t.nodeType;)t=t.parentNode;"SELECT"!=t.tagName&&"INPUT"!=t.tagName&&"TEXTAREA"!=t.tagName&&((n=g.createEvent("MouseEvents")).initMouseEvent("click",!0,!0,e.view,1,c.screenX,c.screenY,c.clientX,c.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,0,null),n._fake=!0,t.dispatchEvent(n))},l.options.zoom?250:0))),l._resetPos(400),void(l.options.onTouchEnd&&l.options.onTouchEnd.call(l,e));if(d<300&&l.options.momentum&&(u=f?l._momentum(f-l.startX,d,-l.x,l.scrollerW-l.wrapperW+l.x,l.options.bounce?l.wrapperW:0):u,p=h?l._momentum(h-l.startY,d,-l.y,l.maxScrollY<0?l.scrollerH-l.wrapperH+l.y-l.minScrollY:0,l.options.bounce?l.wrapperH:0):p,f=l.x+u.dist,h=l.y+p.dist,(0<l.x&&0<f||l.x<l.maxScrollX&&f<l.maxScrollX)&&(u={dist:0,time:0}),(l.y>l.minScrollY&&h>l.minScrollY||l.y<l.maxScrollY&&h<l.maxScrollY)&&(p={dist:0,time:0})),u.dist||p.dist)return r=v.max(v.max(u.time,p.time),10),l.options.snap&&(o=f-l.absStartX,i=h-l.absStartY,v.abs(o)<l.options.snapThreshold&&v.abs(i)<l.options.snapThreshold?l.scrollTo(l.absStartX,l.absStartY,200):(f=(a=l._snap(f,h)).x,h=a.y,r=v.max(a.time,r))),l.scrollTo(v.round(f),v.round(h),r),void(l.options.onTouchEnd&&l.options.onTouchEnd.call(l,e));if(l.options.snap)return o=f-l.absStartX,i=h-l.absStartY,v.abs(o)<l.options.snapThreshold&&v.abs(i)<l.options.snapThreshold?l.scrollTo(l.absStartX,l.absStartY,200):(a=l._snap(l.x,l.y)).x==l.x&&a.y==l.y||l.scrollTo(a.x,a.y,a.time),void(l.options.onTouchEnd&&l.options.onTouchEnd.call(l,e));l._resetPos(200),l.options.onTouchEnd&&l.options.onTouchEnd.call(l,e)}},_resetPos:function(e){var t=this,n=0<=t.x?0:t.x<t.maxScrollX?t.maxScrollX:t.x,o=t.y>=t.minScrollY||0<t.maxScrollY?t.minScrollY:t.y<t.maxScrollY?t.maxScrollY:t.y;if(n==t.x&&o==t.y)return t.moved&&(t.moved=!1,t.options.onScrollEnd&&t.options.onScrollEnd.call(t)),t.hScrollbar&&t.options.hideScrollbar&&("webkit"==i&&(t.hScrollbarWrapper.style[c]="300ms"),t.hScrollbarWrapper.style.opacity="0"),void(t.vScrollbar&&t.options.hideScrollbar&&("webkit"==i&&(t.vScrollbarWrapper.style[c]="300ms"),t.vScrollbarWrapper.style.opacity="0"));t.scrollTo(n,o,e||0)},_wheel:function(e){var t,n,o,i,r,a=this;if("wheelDeltaX"in e)t=e.wheelDeltaX/12,n=e.wheelDeltaY/12;else if("wheelDelta"in e)t=n=e.wheelDelta/12;else{if(!("detail"in e))return;t=n=3*-e.detail}if("zoom"==a.options.wheelAction)return(r=a.scale*Math.pow(2,1/3*(n?n/Math.abs(n):0)))<a.options.zoomMin&&(r=a.options.zoomMin),r>a.options.zoomMax&&(r=a.options.zoomMax),void(r!=a.scale&&(!a.wheelZoomCount&&a.options.onZoomStart&&a.options.onZoomStart.call(a,e),a.wheelZoomCount++,a.zoom(e.pageX,e.pageY,r,400),setTimeout(function(){a.wheelZoomCount--,!a.wheelZoomCount&&a.options.onZoomEnd&&a.options.onZoomEnd.call(a,e)},400)));o=a.x+t,i=a.y+n,0<o?o=0:o<a.maxScrollX&&(o=a.maxScrollX),i>a.minScrollY?i=a.minScrollY:i<a.maxScrollY&&(i=a.maxScrollY),a.maxScrollY<0&&a.scrollTo(o,i,0)},_transitionEnd:function(e){e.target==this.scroller&&(this._unbind(C),this._startAni())},_startAni:function(){var o,i,r,a=this,s=a.x,l=a.y,c=Date.now();if(!a.animating)if(a.steps.length){if((o=a.steps.shift()).x==s&&o.y==l&&(o.time=0),a.animating=!0,a.moved=!0,a.options.useTransition)return a._transitionTime(o.time),a._pos(o.x,o.y),a.animating=!1,void(o.time?a._bind(C):a._resetPos(0));(r=function(){var e,t,n=Date.now();if(n>=c+o.time)return a._pos(o.x,o.y),a.animating=!1,a.options.onAnimationEnd&&a.options.onAnimationEnd.call(a),void a._startAni();n=(n-c)/o.time-1,i=v.sqrt(1-n*n),e=(o.x-s)*i+s,t=(o.y-l)*i+l,a._pos(e,t),a.animating&&(a.aniTime=A(r))})()}else a._resetPos(400)},_transitionTime:function(e){e+="ms",this.scroller.style[y]=e,this.hScrollbar&&(this.hScrollbarIndicator.style[y]=e),this.vScrollbar&&(this.vScrollbarIndicator.style[y]=e)},_momentum:function(e,t,n,o,i){var r,a=v.abs(e)/t,s=a*a/.0012;return 0<e&&n<s?(a=a*(n+=i/(6/(s/a*6e-4)))/s,s=n):e<0&&o<s&&(a=a*(o+=i/(6/(s/a*6e-4)))/s,s=o),r=a/6e-4,{dist:s*=e<0?-1:1,time:v.round(r)}},_offset:function(e){for(var t=-e.offsetLeft,n=-e.offsetTop;e=e.offsetParent;)t-=e.offsetLeft,n-=e.offsetTop;return e!=this.wrapper&&(t*=this.scale,n*=this.scale),{left:t,top:n}},_snap:function(e,t){var n,o,i,r,a,s=this;for(i=s.pagesX.length-1,n=0,o=s.pagesX.length;n<o;n++)if(e>=s.pagesX[n]){i=n;break}for(i==s.currPageX&&0<i&&s.dirX<0&&i--,e=s.pagesX[i],r=(r=v.abs(e-s.pagesX[s.currPageX]))?v.abs(s.x-e)/r*500:0,s.currPageX=i,i=s.pagesY.length-1,n=0;n<i;n++)if(t>=s.pagesY[n]){i=n;break}return i==s.currPageY&&0<i&&s.dirY<0&&i--,t=s.pagesY[i],a=(a=v.abs(t-s.pagesY[s.currPageY]))?v.abs(s.y-t)/a*500:0,s.currPageY=i,{x:e,y:t,time:v.round(v.max(r,a))||200}},_bind:function(e,t,n){(t||this.scroller).addEventListener(e,this,!!n)},_unbind:function(e,t,n){(t||this.scroller).removeEventListener(e,this,!!n)},destroy:function(){var e=this;e.scroller.style[b]="",e.hScrollbar=!1,e.vScrollbar=!1,e._scrollbar("h"),e._scrollbar("v"),e._unbind(x,m),e._unbind(S),e._unbind(_,m),e._unbind(k,m),e._unbind(T,m),e.options.hasTouch||e._unbind(E),e.options.useTransition&&e._unbind(C),e.options.checkDOMChanges&&clearInterval(e.checkDOMTime),e.options.onDestroy&&e.options.onDestroy.call(e)},refresh:function(){var e,t,n,o,i=this,r=0,a=0;if(i.scale<i.options.zoomMin&&(i.scale=i.options.zoomMin),i.wrapperW=i.wrapper.clientWidth||1,i.wrapperH=i.wrapper.clientHeight||1,i.minScrollY=-i.options.topOffset||0,i.scrollerW=v.round(i.scroller.offsetWidth*i.scale),i.scrollerH=v.round((i.scroller.offsetHeight+i.minScrollY)*i.scale),i.maxScrollX=i.wrapperW-i.scrollerW,i.maxScrollY=i.wrapperH-i.scrollerH+i.minScrollY,i.dirX=0,i.dirY=0,i.options.onRefresh&&i.options.onRefresh.call(i),i.hScroll=i.options.hScroll&&i.maxScrollX<0,i.vScroll=i.options.vScroll&&(!i.options.bounceLock&&!i.hScroll||i.scrollerH>i.wrapperH),i.hScrollbar=i.hScroll&&i.options.hScrollbar,i.vScrollbar=i.vScroll&&i.options.vScrollbar&&i.scrollerH>i.wrapperH,e=i._offset(i.wrapper),i.wrapperOffsetLeft=-e.left,i.wrapperOffsetTop=-e.top,"string"==typeof i.options.snap)for(i.pagesX=[],i.pagesY=[],t=0,n=(o=i.scroller.querySelectorAll(i.options.snap)).length;t<n;t++)(r=i._offset(o[t])).left+=i.wrapperOffsetLeft,r.top+=i.wrapperOffsetTop,i.pagesX[t]=r.left<i.maxScrollX?i.maxScrollX:r.left*i.scale,i.pagesY[t]=r.top<i.maxScrollY?i.maxScrollY:r.top*i.scale;else if(i.options.snap){for(i.pagesX=[];r>=i.maxScrollX;)i.pagesX[a]=r,r-=i.wrapperW,a++;for(i.maxScrollX%i.wrapperW&&(i.pagesX[i.pagesX.length]=i.maxScrollX-i.pagesX[i.pagesX.length-1]+i.pagesX[i.pagesX.length-1]),a=r=0,i.pagesY=[];r>=i.maxScrollY;)i.pagesY[a]=r,r-=i.wrapperH,a++;i.maxScrollY%i.wrapperH&&(i.pagesY[i.pagesY.length]=i.maxScrollY-i.pagesY[i.pagesY.length-1]+i.pagesY[i.pagesY.length-1])}i._scrollbar("h"),i._scrollbar("v"),i.zoomed||(i.scroller.style[y]="0",i._resetPos(400))},scrollTo:function(e,t,n,o){var i,r,a=this,s=e;for(a.stop(),s.length||(s=[{x:e,y:t,time:n,relative:o}]),i=0,r=s.length;i<r;i++)s[i].relative&&(s[i].x=a.x-s[i].x,s[i].y=a.y-s[i].y),a.steps.push({x:s[i].x,y:s[i].y,time:s[i].time||0});a._startAni()},scrollToElement:function(e,t){var n,o=this;(e=e.nodeType?e:o.scroller.querySelector(e))&&((n=o._offset(e)).left+=o.wrapperOffsetLeft,n.top+=o.wrapperOffsetTop,n.left=0<n.left?0:n.left<o.maxScrollX?o.maxScrollX:n.left,n.top=n.top>o.minScrollY?o.minScrollY:n.top<o.maxScrollY?o.maxScrollY:n.top,t=void 0===t?v.max(2*v.abs(n.left),2*v.abs(n.top)):t,o.scrollTo(n.left,n.top,t))},scrollToPage:function(e,t,n){var o,i,r=this;n=void 0===n?400:n,r.options.onScrollStart&&r.options.onScrollStart.call(r),r.options.snap?(e="next"==e?r.currPageX+1:"prev"==e?r.currPageX-1:e,t="next"==t?r.currPageY+1:"prev"==t?r.currPageY-1:t,e=e<0?0:e>r.pagesX.length-1?r.pagesX.length-1:e,t=t<0?0:t>r.pagesY.length-1?r.pagesY.length-1:t,r.currPageX=e,r.currPageY=t,o=r.pagesX[e],i=r.pagesY[t]):(o=-r.wrapperW*e,i=-r.wrapperH*t,o<r.maxScrollX&&(o=r.maxScrollX),i<r.maxScrollY&&(i=r.maxScrollY)),r.scrollTo(o,i,n)},disable:function(){this.stop(),this._resetPos(0),this.enabled=!1,this._unbind(_,m),this._unbind(k,m),this._unbind(T,m)},enable:function(){this.enabled=!0},stop:function(){this.options.useTransition?this._unbind(C):D(this.aniTime),this.steps=[],this.moved=!1,this.animating=!1},zoom:function(e,t,n,o){var i=this,r=n/i.scale;i.options.useTransform&&(i.zoomed=!0,o=void 0===o?200:o,e=e-i.wrapperOffsetLeft-i.x,t=t-i.wrapperOffsetTop-i.y,i.x=e-e*r+i.x,i.y=t-t*r+i.y,i.scale=n,i.refresh(),i.x=0<i.x?0:i.x<i.maxScrollX?i.maxScrollX:i.x,i.y=i.y>i.minScrollY?i.minScrollY:i.y<i.maxScrollY?i.maxScrollY:i.y,i.scroller.style[y]=o+"ms",i.scroller.style[b]="translate("+i.x+"px,"+i.y+"px) scale("+n+")"+z,i.zoomed=!1)},isReady:function(){return!this.moved&&!this.zoomed&&!this.animating}},o=null,"undefined"!=typeof exports?exports.iScroll=t:m.iScroll=t}(window,document),function(){function P(e){throw e}var I=null;function B(e){return function(){return e}}var L=window,j=document,q=navigator,F=window.jQuery,U=void 0;function e(e){function S(e,t,n,o,i){var r=[];return e=k.j(function(){var e=t(n,i)||[];0<r.length&&(k.a.Ya(_(r),e),o&&k.r.K(o,I,[n,e,i])),r.splice(0,r.length),k.a.P(r,e)},I,{W:e,Ka:function(){return 0==r.length||!k.a.X(r[0])}}),{M:r,j:e.pa()?e:U}}function _(e){for(;e.length&&!k.a.X(e[0]);)e.splice(0,1);if(1<e.length){for(var t=e[0],n=e[e.length-1],o=[t];t!==n;){if(!(t=t.nextSibling))return;o.push(t)}Array.prototype.splice.apply(e,[0,e.length].concat(o))}return e}function o(e,t,n,o,i){var r,a,s,l,c,u,p=Math.min,d=Math.max,f=[],h=e.length,m=t.length,g=m-h||1,v=h+m+1;for(r=0;r<=h;r++)for(l=s,f.push(s=[]),c=p(m,r+g),a=d(0,r-1);a<=c;a++)s[a]=a?r?e[r-1]===t[a-1]?l[a-1]:p(l[a]||v,s[a-1]||v)+1:a+1:r+1;for(p=[],d=[],g=[],r=h,a=m;r||a;)m=f[r][a]-1,a&&m===f[r][a-1]?d.push(p[p.length]={status:n,value:t[--a],index:a}):r&&m===f[r-1][a]?g.push(p[p.length]={status:o,value:e[--r],index:r}):(p.push({status:"retained",value:t[--a]}),--r);if(d.length&&g.length)for(e=10*h,t=n=0;(i||t<e)&&(u=d[n]);n++){for(o=0;f=g[o];o++)if(u.value===f.value){u.moved=f.index,f.moved=u.index,g.splice(o,1),t=o=0;break}t+=o}return p.reverse()}function c(e,t,n,o,i){i=i||{};var r=(r=e&&l(e))&&r.ownerDocument,a=i.templateEngine||O;switch(k.za.vb(n,a,r),("number"!=typeof(n=a.renderTemplate(n,o,i,r)).length||0<n.length&&"number"!=typeof n[0].nodeType)&&P(Error("Template engine must return an array of DOM nodes")),r=!1,t){case"replaceChildren":k.e.N(e,n),r=!0;break;case"replaceNode":k.a.Ya(e,n),r=!0;break;case"ignoreTargetNode":break;default:P(Error("Unknown renderMode: "+t))}return r&&(u(n,o),i.afterRender&&k.r.K(i.afterRender,I,[n,o.$data])),n}function l(e){return e.nodeType?e:0<e.length?e[0]:I}function u(e,t){if(e.length){var n=e[0],o=e[e.length-1];i(n,o,function(e){k.Da(t,e)}),i(n,o,function(e){k.s.ib(e,[t])})}}function i(e,t,n){var o;for(t=k.e.nextSibling(t);e&&(o=e)!==t;)e=k.e.nextSibling(o),(1===o.nodeType||8===o.nodeType)&&n(o)}function p(e,t,n){e=k.g.aa(e);for(var o=k.g.Q,i=0;i<e.length;i++){var r=e[i].key;if(o.hasOwnProperty(r)){var a=o[r];"function"==typeof a?(r=a(e[i].value))&&P(Error(r)):a||P(Error("This template engine does not support the '"+r+"' binding within its templates"))}}return e="ko.__tr_ambtns(function($context,$element){return(function(){return{ "+k.g.ba(e)+" } })()})",n.createJavaScriptEvaluatorBlock(e)+t}function r(i,r,a,s){function l(e){return function(){return u[e]}}function c(){return u}var u,p,d=0;return k.j(function(){var e=a&&a instanceof k.z?a:new k.z(k.a.d(a)),t=e.$data;if(s&&k.eb(i,e),u=("function"==typeof r?r(e,i):r)||k.J.instance.getBindings(i,e)){if(0===d){for(var n in d=1,u){var o=k.c[n];o&&8===i.nodeType&&!k.e.I[n]&&P(Error("The binding '"+n+"' cannot be used with virtual elements")),o&&"function"==typeof o.init&&(o=(0,o.init)(i,l(n),c,t,e))&&o.controlsDescendantBindings&&(p!==U&&P(Error("Multiple bindings ("+p+" and "+n+") are trying to control descendant bindings of the same element. You cannot use these bindings together on the same element.")),p=n)}d=2}if(2===d)for(n in u)(o=k.c[n])&&"function"==typeof o.update&&(0,o.update)(i,l(n),c,t,e)}},I,{W:i}),{Nb:p===U}}function a(e,t,n){var o=!0,i=1===t.nodeType;i&&k.e.Ta(t),(i&&n||k.J.instance.nodeHasBindings(t))&&(o=r(t,I,e,n).Nb),o&&s(e,t,!i)}function s(e,t,n){for(var o=k.e.firstChild(t);t=o;)o=k.e.nextSibling(t),a(e,t,n)}function d(e,t){var n=f(e,t);return n?0<n.length?n[n.length-1].nextSibling:e.nextSibling:I}function f(e,t){for(var n=e,o=1,i=[];n=n.nextSibling;){if(h(n)&&0===--o)return i;i.push(n),m(n)&&o++}return t||P(Error("Cannot find closing comment tag to match: "+e.nodeValue)),I}function h(e){return 8==e.nodeType&&(A?e.text:e.nodeValue).match(z)}function m(e){return 8==e.nodeType&&(A?e.text:e.nodeValue).match(D)}function g(e,n){for(var t=I;e!=t;)e=(t=e).replace(T,function(e,t){return n[t]});return e}function v(){var o=[],i=[];this.save=function(e,t){var n=k.a.i(o,e);0<=n?i[n]=t:(o.push(e),i.push(t))},this.get=function(e){return 0<=(e=k.a.i(o,e))?i[e]:U}}function t(e,a,s,l){k.c[e]={init:function(e){return k.a.f.set(e,R,{}),{controlsDescendantBindings:!0}},update:function(e,t,n,o,i){n=k.a.f.get(e,R),t=k.a.d(t()),o=!s!=!t;var r=!n.Za;(r||a||o!==n.qb)&&(r&&(n.Za=k.a.Ia(k.e.childNodes(e),!0)),o?(r||k.e.N(e,k.a.Ia(n.Za)),k.Ea(l?l(i,t):i,e)):k.e.Y(e),n.qb=o)}},k.g.Q[e]=!1,k.e.I[e]=!0}function b(e,t,n){n&&t!==k.k.q(e)&&k.k.T(e,t),t!==k.k.q(e)&&k.r.K(k.a.Ba,I,[e,"change"])}var k=void 0!==e?e:{};k.b=function(e,t){for(var n=e.split("."),o=k,i=0;i<n.length-1;i++)o=o[n[i]];o[n[n.length-1]]=t},k.p=function(e,t,n){e[t]=n},k.version="2.2.1",k.b("version",k.version),k.a=new function(){function r(e,t){if("input"!==k.a.u(e)||!e.type||"click"!=t.toLowerCase())return!1;var n=e.type;return"checkbox"==n||"radio"==n}var t=/^(\s|\u00A0)+|(\s|\u00A0)+$/g,e={},o={};for(var n in e[/Firefox\/2/i.test(q.userAgent)?"KeyboardEvent":"UIEvents"]=["keyup","keydown","keypress"],e.MouseEvents="click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave".split(" "),e){var i=e[n];if(i.length)for(var a=0,s=i.length;a<s;a++)o[i[a]]=n}var l,c={propertychange:!0};e=3;for(i=(n=j.createElement("div")).getElementsByTagName("i");n.innerHTML="\x3c!--[if gt IE "+ ++e+"]><i></i><![endif]--\x3e",i[0];);return{Na:["authenticity_token",/^__RequestVerificationToken(_.*)?$/],o:function(e,t){for(var n=0,o=e.length;n<o;n++)t(e[n])},i:function(e,t){if("function"==typeof Array.prototype.indexOf)return Array.prototype.indexOf.call(e,t);for(var n=0,o=e.length;n<o;n++)if(e[n]===t)return n;return-1},lb:function(e,t,n){for(var o=0,i=e.length;o<i;o++)if(t.call(n,e[o]))return e[o];return I},ga:function(e,t){var n=k.a.i(e,t);0<=n&&e.splice(n,1)},Ga:function(e){for(var t=[],n=0,o=(e=e||[]).length;n<o;n++)k.a.i(t,e[n])<0&&t.push(e[n]);return t},V:function(e,t){for(var n=[],o=0,i=(e=e||[]).length;o<i;o++)n.push(t(e[o]));return n},fa:function(e,t){for(var n=[],o=0,i=(e=e||[]).length;o<i;o++)t(e[o])&&n.push(e[o]);return n},P:function(e,t){if(t instanceof Array)e.push.apply(e,t);else for(var n=0,o=t.length;n<o;n++)e.push(t[n]);return e},extend:function(e,t){if(t)for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},ka:function(e){for(;e.firstChild;)k.removeNode(e.firstChild)},Hb:function(e){e=k.a.L(e);for(var t=j.createElement("div"),n=0,o=e.length;n<o;n++)t.appendChild(k.A(e[n]));return t},Ia:function(e,t){for(var n=0,o=e.length,i=[];n<o;n++){var r=e[n].cloneNode(!0);i.push(t?k.A(r):r)}return i},N:function(e,t){if(k.a.ka(e),t)for(var n=0,o=t.length;n<o;n++)e.appendChild(t[n])},Ya:function(e,t){var n=e.nodeType?[e]:e;if(0<n.length){for(var o=n[0],i=o.parentNode,r=0,a=t.length;r<a;r++)i.insertBefore(t[r],o);for(r=0,a=n.length;r<a;r++)k.removeNode(n[r])}},bb:function(e,t){l<7?e.setAttribute("selected",t):e.selected=t},D:function(e){return(e||"").replace(t,"")},Rb:function(e,t){for(var n=[],o=(e||"").split(t),i=0,r=o.length;i<r;i++){var a=k.a.D(o[i]);""!==a&&n.push(a)}return n},Ob:function(e,t){return e=e||"",!(t.length>e.length)&&e.substring(0,t.length)===t},tb:function(e,t){if(t.compareDocumentPosition)return 16==(16&t.compareDocumentPosition(e));for(;e!=I;){if(e==t)return!0;e=e.parentNode}return!1},X:function(e){return k.a.tb(e,e.ownerDocument)},u:function(e){return e&&e.tagName&&e.tagName.toLowerCase()},n:function(t,e,n){var o=l&&c[e];if(o||void 0===F)o||"function"!=typeof t.addEventListener?void 0!==t.attachEvent?t.attachEvent("on"+e,function(e){n.call(t,e)}):P(Error("Browser doesn't support addEventListener or attachEvent")):t.addEventListener(e,n,!1);else{if(r(t,e)){var i=n;n=function(e,t){var n=this.checked;t&&(this.checked=!0!==t.nb),i.call(this,e),this.checked=n}}F(t).bind(e,n)}},Ba:function(e,t){if((!e||!e.nodeType)&&P(Error("element must be a DOM node when calling triggerEvent")),void 0!==F){var n=[];r(e,t)&&n.push({nb:e.checked}),F(e).trigger(t,n)}else"function"==typeof j.createEvent?"function"==typeof e.dispatchEvent?((n=j.createEvent(o[t]||"HTMLEvents")).initEvent(t,!0,!0,L,0,0,0,0,0,!1,!1,!1,!1,0,e),e.dispatchEvent(n)):P(Error("The supplied element doesn't support dispatchEvent")):void 0!==e.fireEvent?(r(e,t)&&(e.checked=!0!==e.checked),e.fireEvent("on"+t)):P(Error("Browser doesn't support triggering events"))},d:function(e){return k.$(e)?e():e},ua:function(e){return k.$(e)?e.t():e},da:function(e,t,n){if(t){var o=/[\w-]+/g,i=e.className.match(o)||[];k.a.o(t.match(o),function(e){var t=k.a.i(i,e);0<=t?n||i.splice(t,1):n&&i.push(e)}),e.className=i.join(" ")}},cb:function(e,t){var n=k.a.d(t);if(n!==I&&n!==U||(n=""),3===e.nodeType)e.data=n;else{var o=k.e.firstChild(e);!o||3!=o.nodeType||k.e.nextSibling(o)?k.e.N(e,[j.createTextNode(n)]):o.data=n,k.a.wb(e)}},ab:function(e,t){if(e.name=t,l<=7)try{e.mergeAttributes(j.createElement("<input name='"+e.name+"'/>"),!1)}catch(e){}},wb:function(e){9<=l&&((e=1==e.nodeType?e:e.parentNode).style&&(e.style.zoom=e.style.zoom))},ub:function(e){if(9<=l){var t=e.style.width;e.style.width=0,e.style.width=t}},Lb:function(e,t){e=k.a.d(e),t=k.a.d(t);for(var n=[],o=e;o<=t;o++)n.push(o);return n},L:function(e){for(var t=[],n=0,o=e.length;n<o;n++)t.push(e[n]);return t},Pb:6===(l=4<e?e:U),Qb:7===l,Z:l,Oa:function(e,t){for(var n=k.a.L(e.getElementsByTagName("input")).concat(k.a.L(e.getElementsByTagName("textarea"))),o="string"==typeof t?function(e){return e.name===t}:function(e){return t.test(e.name)},i=[],r=n.length-1;0<=r;r--)o(n[r])&&i.push(n[r]);return i},Ib:function(e){return"string"==typeof e&&(e=k.a.D(e))?L.JSON&&L.JSON.parse?L.JSON.parse(e):new Function("return "+e)():I},xa:function(e,t,n){return("undefined"==typeof JSON||void 0===JSON.stringify)&&P(Error("Cannot find JSON.stringify(). Some browsers (e.g., IE < 8) don't support it natively, but you can overcome this by adding a script reference to json2.js, downloadable from http://www.json.org/json2.js")),JSON.stringify(k.a.d(e),t,n)},Jb:function(e,t,n){var o=(n=n||{}).params||{},i=n.includeFields||this.Na,r=e;if("object"==typeof e&&"form"===k.a.u(e)){r=e.action;for(var a=i.length-1;0<=a;a--)for(var s=k.a.Oa(e,i[a]),l=s.length-1;0<=l;l--)o[s[l].name]=s[l].value}t=k.a.d(t);var c=j.createElement("form");for(var u in c.style.display="none",c.action=r,c.method="post",t)(e=j.createElement("input")).name=u,e.value=k.a.xa(k.a.d(t[u])),c.appendChild(e);for(u in o)(e=j.createElement("input")).name=u,e.value=o[u],c.appendChild(e);j.body.appendChild(c),n.submitter?n.submitter(c):c.submit(),setTimeout(function(){c.parentNode.removeChild(c)},0)}}},k.b("utils",k.a),k.b("utils.arrayForEach",k.a.o),k.b("utils.arrayFirst",k.a.lb),k.b("utils.arrayFilter",k.a.fa),k.b("utils.arrayGetDistinctValues",k.a.Ga),k.b("utils.arrayIndexOf",k.a.i),k.b("utils.arrayMap",k.a.V),k.b("utils.arrayPushAll",k.a.P),k.b("utils.arrayRemoveItem",k.a.ga),k.b("utils.extend",k.a.extend),k.b("utils.fieldsIncludedWithJsonPost",k.a.Na),k.b("utils.getFormFields",k.a.Oa),k.b("utils.peekObservable",k.a.ua),k.b("utils.postJson",k.a.Jb),k.b("utils.parseJson",k.a.Ib),k.b("utils.registerEventHandler",k.a.n),k.b("utils.stringifyJson",k.a.xa),k.b("utils.range",k.a.Lb),k.b("utils.toggleDomNodeCssClass",k.a.da),k.b("utils.triggerEvent",k.a.Ba),k.b("utils.unwrapObservable",k.a.d),Function.prototype.bind||(Function.prototype.bind=function(e){var t=this,n=Array.prototype.slice.call(arguments);return e=n.shift(),function(){return t.apply(e,n.concat(Array.prototype.slice.call(arguments)))}}),k.a.f=new function(){var o=0,i="__ko__"+(new Date).getTime(),r={};return{get:function(e,t){var n=k.a.f.la(e,!1);return n===U?U:n[t]},set:function(e,t,n){n===U&&k.a.f.la(e,!1)===U||(k.a.f.la(e,!0)[t]=n)},la:function(e,t){var n=e[i];if(!n||"null"===n||!r[n]){if(!t)return U;n=e[i]="ko"+o++,r[n]={}}return r[n]},clear:function(e){var t=e[i];return!!t&&(delete r[t],!(e[i]=I))}}},k.b("utils.domData",k.a.f),k.b("utils.domData.clear",k.a.f.clear),k.a.F=new function(){function o(e,t){var n=k.a.f.get(e,r);return n===U&&t&&(n=[],k.a.f.set(e,r,n)),n}function i(e){if(t=o(e,!1))for(var t=t.slice(0),n=0;n<t.length;n++)t[n](e);if(k.a.f.clear(e),"function"==typeof F&&"function"==typeof F.cleanData&&F.cleanData([e]),s[e.nodeType])for(t=e.firstChild;e=t;)t=e.nextSibling,8===e.nodeType&&i(e)}var r="__ko_domNodeDisposal__"+(new Date).getTime(),a={1:!0,8:!0,9:!0},s={1:!0,9:!0};return{Ca:function(e,t){"function"!=typeof t&&P(Error("Callback must be a function")),o(e,!0).push(t)},Xa:function(e,t){var n=o(e,!1);n&&(k.a.ga(n,t),0==n.length&&k.a.f.set(e,r,U))},A:function(e){if(a[e.nodeType]&&(i(e),s[e.nodeType])){var t=[];k.a.P(t,e.getElementsByTagName("*"));for(var n=0,o=t.length;n<o;n++)i(t[n])}return e},removeNode:function(e){k.A(e),e.parentNode&&e.parentNode.removeChild(e)}}},k.A=k.a.F.A,k.removeNode=k.a.F.removeNode,k.b("cleanNode",k.A),k.b("removeNode",k.removeNode),k.b("utils.domNodeDisposal",k.a.F),k.b("utils.domNodeDisposal.addDisposeCallback",k.a.F.Ca),k.b("utils.domNodeDisposal.removeDisposeCallback",k.a.F.Xa),k.a.ta=function(e){var t;if(void 0!==F){if(F.parseHTML)t=F.parseHTML(e);else if((t=F.clean([e]))&&t[0]){for(e=t[0];e.parentNode&&11!==e.parentNode.nodeType;)e=e.parentNode;e.parentNode&&e.parentNode.removeChild(e)}}else{var n=k.a.D(e).toLowerCase();for(t=j.createElement("div"),e="ignored<div>"+(n=n.match(/^<(thead|tbody|tfoot)/)&&[1,"<table>","</table>"]||!n.indexOf("<tr")&&[2,"<table><tbody>","</tbody></table>"]||(!n.indexOf("<td")||!n.indexOf("<th"))&&[3,"<table><tbody><tr>","</tr></tbody></table>"]||[0,"",""])[1]+e+n[2]+"</div>","function"==typeof L.innerShiv?t.appendChild(L.innerShiv(e)):t.innerHTML=e;n[0]--;)t=t.lastChild;t=k.a.L(t.lastChild.childNodes)}return t},k.a.ca=function(e,t){if(k.a.ka(e),(t=k.a.d(t))!==I&&t!==U)if("string"!=typeof t&&(t=t.toString()),void 0!==F)F(e).html(t);else for(var n=k.a.ta(t),o=0;o<n.length;o++)e.appendChild(n[o])},k.b("utils.parseHtmlFragment",k.a.ta),k.b("utils.setHtml",k.a.ca);var y={};k.s={ra:function(e){"function"!=typeof e&&P(Error("You can only pass a function to ko.memoization.memoize()"));var t=(4294967296*(1+Math.random())|0).toString(16).substring(1)+(4294967296*(1+Math.random())|0).toString(16).substring(1);return y[t]=e,"\x3c!--[ko_memo:"+t+"]--\x3e"},hb:function(e,t){var n=y[e];n===U&&P(Error("Couldn't find any memo with ID "+e+". Perhaps it's already been unmemoized."));try{return n.apply(I,t||[]),!0}finally{delete y[e]}},ib:function(e,t){var n=[];!function e(t,n){if(t)if(8==t.nodeType)(o=k.s.Ua(t.nodeValue))!=I&&n.push({sb:t,Fb:o});else if(1==t.nodeType)for(var o=0,i=t.childNodes,r=i.length;o<r;o++)e(i[o],n)}(e,n);for(var o=0,i=n.length;o<i;o++){var r=n[o].sb,a=[r];t&&k.a.P(a,t),k.s.hb(n[o].Fb,a),r.nodeValue="",r.parentNode&&r.parentNode.removeChild(r)}},Ua:function(e){return(e=e.match(/^\[ko_memo\:(.*?)\]$/))?e[1]:I}},k.b("memoization",k.s),k.b("memoization.memoize",k.s.ra),k.b("memoization.unmemoize",k.s.hb),k.b("memoization.parseMemoText",k.s.Ua),k.b("memoization.unmemoizeDomNodeAndDescendants",k.s.ib),k.Ma={throttle:function(t,n){t.throttleEvaluation=n;var o=I;return k.j({read:t,write:function(e){clearTimeout(o),o=setTimeout(function(){t(e)},n)}})},notify:function(e,t){return e.equalityComparer="always"==t?B(!1):k.m.fn.equalityComparer,e}},k.b("extenders",k.Ma),k.fb=function(e,t,n){this.target=e,this.ha=t,this.rb=n,k.p(this,"dispose",this.B)},k.fb.prototype.B=function(){this.Cb=!0,this.rb()},k.S=function(){this.w={},k.a.extend(this,k.S.fn),k.p(this,"subscribe",this.ya),k.p(this,"extend",this.extend),k.p(this,"getSubscriptionsCount",this.yb)},k.S.fn={ya:function(e,t,n){n=n||"change";var o=new k.fb(this,t?e.bind(t):e,function(){k.a.ga(this.w[n],o)}.bind(this));return this.w[n]||(this.w[n]=[]),this.w[n].push(o),o},notifySubscribers:function(t,e){e=e||"change",this.w[e]&&k.r.K(function(){k.a.o(this.w[e].slice(0),function(e){e&&!0!==e.Cb&&e.ha(t)})},this)},yb:function(){var e,t=0;for(e in this.w)this.w.hasOwnProperty(e)&&(t+=this.w[e].length);return t},extend:function(e){var t=this;if(e)for(var n in e){var o=k.Ma[n];"function"==typeof o&&(t=o(t,e[n]))}return t}},k.Qa=function(e){return"function"==typeof e.ya&&"function"==typeof e.notifySubscribers},k.b("subscribable",k.S),k.b("isSubscribable",k.Qa);var w=[];k.r={mb:function(e){w.push({ha:e,La:[]})},end:function(){w.pop()},Wa:function(e){if(k.Qa(e)||P(Error("Only subscribable things can act as dependencies")),0<w.length){var t=w[w.length-1];t&&!(0<=k.a.i(t.La,e))&&(t.La.push(e),t.ha(e))}},K:function(e,t,n){try{return w.push(I),e.apply(t,n||[])}finally{w.pop()}}};var n={undefined:!0,boolean:!0,number:!0,string:!0};k.m=function(e){function t(){return 0<arguments.length?(t.equalityComparer&&t.equalityComparer(n,arguments[0])||(t.H(),n=arguments[0],t.G()),this):(k.r.Wa(t),n)}var n=e;return k.S.call(t),t.t=function(){return n},t.G=function(){t.notifySubscribers(n)},t.H=function(){t.notifySubscribers(n,"beforeChange")},k.a.extend(t,k.m.fn),k.p(t,"peek",t.t),k.p(t,"valueHasMutated",t.G),k.p(t,"valueWillMutate",t.H),t},k.m.fn={equalityComparer:function(e,t){return(e===I||typeof e in n)&&e===t}};var x=k.m.Kb="__ko_proto__";k.m.fn[x]=k.m,k.ma=function(e,t){return e!==I&&e!==U&&e[x]!==U&&(e[x]===t||k.ma(e[x],t))},k.$=function(e){return k.ma(e,k.m)},k.Ra=function(e){return!!("function"==typeof e&&e[x]===k.m||"function"==typeof e&&e[x]===k.j&&e.zb)},k.b("observable",k.m),k.b("isObservable",k.$),k.b("isWriteableObservable",k.Ra),k.R=function(e){0==arguments.length&&(e=[]),e!==I&&e!==U&&!("length"in e)&&P(Error("The argument passed when initializing an observable array must be an array, or null, or undefined."));var t=k.m(e);return k.a.extend(t,k.R.fn),t},k.R.fn={remove:function(t){for(var e=this.t(),n=[],o="function"==typeof t?t:function(e){return e===t},i=0;i<e.length;i++){var r=e[i];o(r)&&(0===n.length&&this.H(),n.push(r),e.splice(i,1),i--)}return n.length&&this.G(),n},removeAll:function(t){if(t===U){var e=this.t(),n=e.slice(0);return this.H(),e.splice(0,e.length),this.G(),n}return t?this.remove(function(e){return 0<=k.a.i(t,e)}):[]},destroy:function(t){var e=this.t(),n="function"==typeof t?t:function(e){return e===t};this.H();for(var o=e.length-1;0<=o;o--)n(e[o])&&(e[o]._destroy=!0);this.G()},destroyAll:function(t){return t===U?this.destroy(B(!0)):t?this.destroy(function(e){return 0<=k.a.i(t,e)}):[]},indexOf:function(e){var t=this();return k.a.i(t,e)},replace:function(e,t){var n=this.indexOf(e);0<=n&&(this.H(),this.t()[n]=t,this.G())}},k.a.o("pop push reverse shift sort splice unshift".split(" "),function(t){k.R.fn[t]=function(){var e=this.t();return this.H(),e=e[t].apply(e,arguments),this.G(),e}}),k.a.o(["slice"],function(t){k.R.fn[t]=function(){var e=this();return e[t].apply(e,arguments)}}),k.b("observableArray",k.R),k.j=function(e,o,t){function n(){k.a.o(g,function(e){e.B()}),g=[]}function i(){var e=a.throttleEvaluation;e&&0<=e?(clearTimeout(v),v=setTimeout(r,e)):r()}function r(){if(!u)if(c&&h())m();else{u=!0;try{var n=k.a.V(g,function(e){return e.target});k.r.mb(function(e){var t;0<=(t=k.a.i(n,e))?n[t]=U:g.push(e.ya(i))});for(var e=p.call(o),t=n.length-1;0<=t;t--)n[t]&&g.splice(t,1)[0].B();c=!0,a.notifySubscribers(l,"beforeChange"),l=e}finally{k.r.end()}a.notifySubscribers(l),u=!1,g.length||m()}}function a(){return 0<arguments.length?("function"==typeof d?d.apply(o,arguments):P(Error("Cannot write a value to a ko.computed unless you specify a 'write' option. If you wish to read the current value, don't pass any parameters.")),this):(c||r(),k.r.Wa(a),l)}function s(){return!c||0<g.length}var l,c=!1,u=!1,p=e;p&&"object"==typeof p?p=(t=p).read:(t=t||{},p||(p=t.read)),"function"!=typeof p&&P(Error("Pass a function that returns the value of the ko.computed"));var d=t.write,f=t.disposeWhenNodeIsRemoved||t.W||I,h=t.disposeWhen||t.Ka||B(!1),m=n,g=[],v=I;if(o||(o=t.owner),a.t=function(){return c||r(),l},a.xb=function(){return g.length},a.zb="function"==typeof t.write,a.B=function(){m()},a.pa=s,k.S.call(a),k.a.extend(a,k.j.fn),k.p(a,"peek",a.t),k.p(a,"dispose",a.B),k.p(a,"isActive",a.pa),k.p(a,"getDependenciesCount",a.xb),!0!==t.deferEvaluation&&r(),f&&s()){m=function(){k.a.F.Xa(f,arguments.callee),n()},k.a.F.Ca(f,m);var b=h;h=function(){return!k.a.X(f)||b()}}return a},k.Bb=function(e){return k.ma(e,k.j)},e=k.m.Kb,k.j[e]=k.m,k.j.fn={},k.j.fn[e]=k.j,k.b("dependentObservable",k.j),k.b("computed",k.j),k.b("isComputed",k.Bb),k.gb=function(e){return 0==arguments.length&&P(Error("When calling ko.toJS, pass the object you want to convert.")),function o(i,r,a){function e(e){var t=r(i[e]);switch(typeof t){case"boolean":case"number":case"string":case"function":s[e]=t;break;case"object":case"undefined":var n=a.get(t);s[e]=n!==U?n:o(t,r,a)}}if(a=a||new v,"object"!=typeof(i=r(i))||i===I||i===U||i instanceof Date)return i;var s=i instanceof Array?[]:{};a.save(i,s);var t=i;if(t instanceof Array){for(var n=0;n<t.length;n++)e(n);"function"==typeof t.toJSON&&e("toJSON")}else for(n in t)e(n);return s}(e,function(e){for(var t=0;k.$(e)&&t<10;t++)e=e();return e})},k.toJSON=function(e,t,n){return e=k.gb(e),k.a.xa(e,t,n)},k.b("toJS",k.gb),k.b("toJSON",k.toJSON),k.k={q:function(e){switch(k.a.u(e)){case"option":return!0===e.__ko__hasDomDataOptionValue__?k.a.f.get(e,k.c.options.sa):k.a.Z<=7?e.getAttributeNode("value").specified?e.value:e.text:e.value;case"select":return 0<=e.selectedIndex?k.k.q(e.options[e.selectedIndex]):U;default:return e.value}},T:function(e,t){switch(k.a.u(e)){case"option":switch(typeof t){case"string":k.a.f.set(e,k.c.options.sa,U),"__ko__hasDomDataOptionValue__"in e&&delete e.__ko__hasDomDataOptionValue__,e.value=t;break;default:k.a.f.set(e,k.c.options.sa,t),e.__ko__hasDomDataOptionValue__=!0,e.value="number"==typeof t?t:""}break;case"select":for(var n=e.options.length-1;0<=n;n--)if(k.k.q(e.options[n])==t){e.selectedIndex=n;break}break;default:t!==I&&t!==U||(t=""),e.value=t}}},k.b("selectExtensions",k.k),k.b("selectExtensions.readValue",k.k.q),k.b("selectExtensions.writeValue",k.k.T);var T=/\@ko_token_(\d+)\@/g,E=["true","false"],C=/^(?:[$_a-z][$\w]*|(.+)(\.\s*[$_a-z][$\w]*|\[.+\]))$/i;k.g={Q:[],aa:function(e){if((a=k.a.D(e)).length<3)return[];"{"===a.charAt(0)&&(a=a.substring(1,a.length-1)),e=[];for(var t,n=I,o=0;o<a.length;o++){var i=a.charAt(o);if(n===I)switch(i){case'"':case"'":case"/":n=o,t=i}else if(i==t&&"\\"!==a.charAt(o-1)){i=a.substring(n,o+1),e.push(i);var r="@ko_token_"+(e.length-1)+"@",a=a.substring(0,n)+r+a.substring(o+1);o=o-(i.length-r.length),n=I}}t=n=I;var s=0,l=I;for(o=0;o<a.length;o++){if(i=a.charAt(o),n===I)switch(i){case"{":n=o,l=i,t="}";break;case"(":n=o,l=i,t=")";break;case"[":n=o,l=i,t="]"}i===l?s++:i===t&&(0===--s&&(i=a.substring(n,o+1),e.push(i),r="@ko_token_"+(e.length-1)+"@",a=a.substring(0,n)+r+a.substring(o+1),o-=i.length-r.length,n=I))}for(t=[],n=0,o=(a=a.split(",")).length;n<o;n++)0<(l=(s=a[n]).indexOf(":"))&&l<s.length-1?(i=s.substring(l+1),t.push({key:g(s.substring(0,l),e),value:g(i,e)})):t.push({unknown:g(s,e)});return t},ba:function(e){var t="string"==typeof e?k.g.aa(e):e,n=[];e=[];for(var o,i=0;o=t[i];i++)if(0<n.length&&n.push(","),o.key){var r;e:{r=o.key;var a=k.a.D(r);switch(a.length&&a.charAt(0)){case"'":case'"':break e;default:r="'"+a+"'"}}o=o.value,n.push(r),n.push(":"),n.push(o),o=k.a.D(o),0<=k.a.i(E,k.a.D(o).toLowerCase())?o=!1:o=(a=o.match(C))!==I&&(a[1]?"Object("+a[1]+")"+a[2]:o),o&&(0<e.length&&e.push(", "),e.push(r+" : function(__ko_value) { "+o+" = __ko_value; }"))}else o.unknown&&n.push(o.unknown);return t=n.join(""),0<e.length&&(t=t+", '_ko_property_writers' : { "+e.join("")+" } "),t},Eb:function(e,t){for(var n=0;n<e.length;n++)if(k.a.D(e[n].key)==t)return!0;return!1},ea:function(e,t,n,o,i){e&&k.Ra(e)?(!i||e.t()!==o)&&e(o):(e=t()._ko_property_writers)&&e[n]&&e[n](o)}},k.b("expressionRewriting",k.g),k.b("expressionRewriting.bindingRewriteValidators",k.g.Q),k.b("expressionRewriting.parseObjectLiteral",k.g.aa),k.b("expressionRewriting.preProcessBindings",k.g.ba),k.b("jsonExpressionRewriting",k.g),k.b("jsonExpressionRewriting.insertPropertyAccessorsIntoJson",k.g.ba);var A="\x3c!--test--\x3e"===j.createComment("test").text,D=A?/^\x3c!--\s*ko(?:\s+(.+\s*\:[\s\S]*))?\s*--\x3e$/:/^\s*ko(?:\s+(.+\s*\:[\s\S]*))?\s*$/,z=A?/^\x3c!--\s*\/ko\s*--\x3e$/:/^\s*\/ko\s*$/,M={ul:!0,ol:!0};k.e={I:{},childNodes:function(e){return m(e)?f(e):e.childNodes},Y:function(e){if(m(e))for(var t=0,n=(e=k.e.childNodes(e)).length;t<n;t++)k.removeNode(e[t]);else k.a.ka(e)},N:function(e,t){if(m(e)){k.e.Y(e);for(var n=e.nextSibling,o=0,i=t.length;o<i;o++)n.parentNode.insertBefore(t[o],n)}else k.a.N(e,t)},Va:function(e,t){m(e)?e.parentNode.insertBefore(t,e.nextSibling):e.firstChild?e.insertBefore(t,e.firstChild):e.appendChild(t)},Pa:function(e,t,n){n?m(e)?e.parentNode.insertBefore(t,n.nextSibling):n.nextSibling?e.insertBefore(t,n.nextSibling):e.appendChild(t):k.e.Va(e,t)},firstChild:function(e){return m(e)?!e.nextSibling||h(e.nextSibling)?I:e.nextSibling:e.firstChild},nextSibling:function(e){return m(e)&&(e=d(e)),e.nextSibling&&h(e.nextSibling)?I:e.nextSibling},jb:function(e){return(e=m(e))?e[1]:I},Ta:function(e){if(M[k.a.u(e)]){var t=e.firstChild;if(t)do{if(1===t.nodeType){var n;n=t.firstChild;var o=I;if(n)do{if(o)o.push(n);else if(m(n)){var i=d(n,!0);i?n=i:o=[n]}else h(n)&&(o=[n])}while(n=n.nextSibling);if(n=o)for(o=t.nextSibling,i=0;i<n.length;i++)o?e.insertBefore(n[i],o):e.appendChild(n[i])}}while(t=t.nextSibling)}}},k.b("virtualElements",k.e),k.b("virtualElements.allowedBindings",k.e.I),k.b("virtualElements.emptyNode",k.e.Y),k.b("virtualElements.insertAfter",k.e.Pa),k.b("virtualElements.prepend",k.e.Va),k.b("virtualElements.setDomNodeChildren",k.e.N),k.J=function(){this.Ha={}},k.a.extend(k.J.prototype,{nodeHasBindings:function(e){switch(e.nodeType){case 1:return e.getAttribute("data-bind")!=I;case 8:return k.e.jb(e)!=I;default:return!1}},getBindings:function(e,t){var n=this.getBindingsString(e,t);return n?this.parseBindingsString(n,t,e):I},getBindingsString:function(e){switch(e.nodeType){case 1:return e.getAttribute("data-bind");case 8:return k.e.jb(e);default:return I}},parseBindingsString:function(t,e,n){try{var o;if(!(o=this.Ha[t])){var i,r=this.Ha,a="with($context){with($data||{}){return{"+k.g.ba(t)+"}}}";i=new Function("$context","$element",a),o=r[t]=i}return o(e,n)}catch(e){P(Error("Unable to parse bindings.\nMessage: "+e+";\nBindings value: "+t))}}}),k.J.instance=new k.J,k.b("bindingProvider",k.J),k.c={},k.z=function(e,t,n){t?(k.a.extend(this,t),this.$parentContext=t,this.$parent=t.$data,this.$parents=(t.$parents||[]).slice(0),this.$parents.unshift(this.$parent)):(this.$parents=[],this.$root=e,this.ko=k),this.$data=e,n&&(this[n]=e)},k.z.prototype.createChildContext=function(e,t){return new k.z(e,this,t)},k.z.prototype.extend=function(e){var t=k.a.extend(new k.z,this);return k.a.extend(t,e)},k.eb=function(e,t){if(2!=arguments.length)return k.a.f.get(e,"__ko_bindingContext__");k.a.f.set(e,"__ko_bindingContext__",t)},k.Fa=function(e,t,n){return 1===e.nodeType&&k.e.Ta(e),r(e,t,n,!0)},k.Ea=function(e,t){(1===t.nodeType||8===t.nodeType)&&s(e,t,!0)},k.Da=function(e,t){t&&1!==t.nodeType&&8!==t.nodeType&&P(Error("ko.applyBindings: first parameter should be your view model; second parameter should be a DOM node")),a(e,t=t||L.document.body,!0)},k.ja=function(e){switch(e.nodeType){case 1:case 8:var t=k.eb(e);if(t)return t;if(e.parentNode)return k.ja(e.parentNode)}return U},k.pb=function(e){return(e=k.ja(e))?e.$data:U},k.b("bindingHandlers",k.c),k.b("applyBindings",k.Da),k.b("applyBindingsToDescendants",k.Ea),k.b("applyBindingsToNode",k.Fa),k.b("contextFor",k.ja),k.b("dataFor",k.pb);var N={class:"className",for:"htmlFor"};k.c.attr={update:function(e,t){var n,o=k.a.d(t())||{};for(n in o)if("string"==typeof n){var i=k.a.d(o[n]),r=!1===i||i===I||i===U;r&&e.removeAttribute(n),k.a.Z<=8&&n in N?(n=N[n],r?e.removeAttribute(n):e[n]=i):r||e.setAttribute(n,i.toString()),"name"===n&&k.a.ab(e,r?"":i.toString())}}},k.c.checked={init:function(o,i,r){k.a.n(o,"click",function(){var e;if("checkbox"==o.type)e=o.checked;else{if("radio"!=o.type||!o.checked)return;e=o.value}var t=i(),n=k.a.d(t);"checkbox"==o.type&&n instanceof Array?(e=k.a.i(n,o.value),o.checked&&e<0?t.push(o.value):!o.checked&&0<=e&&t.splice(e,1)):k.g.ea(t,r,"checked",e,!0)}),"radio"==o.type&&!o.name&&k.c.uniqueName.init(o,B(!0))},update:function(e,t){var n=k.a.d(t());"checkbox"==e.type?e.checked=n instanceof Array?0<=k.a.i(n,e.value):n:"radio"==e.type&&(e.checked=e.value==n)}},k.c.css={update:function(e,t){var n=k.a.d(t());if("object"==typeof n)for(var o in n){var i=k.a.d(n[o]);k.a.da(e,o,i)}else n=String(n||""),k.a.da(e,e.__ko__cssValue,!1),e.__ko__cssValue=n,k.a.da(e,n,!0)}},k.c.enable={update:function(e,t){var n=k.a.d(t());n&&e.disabled?e.removeAttribute("disabled"):!n&&!e.disabled&&(e.disabled=!0)}},k.c.disable={update:function(e,t){k.c.enable.update(e,function(){return!k.a.d(t())})}},k.c.event={init:function(e,a,s,l){var t,n=a()||{};for(t in n)!function(){var r=t;"string"==typeof r&&k.a.n(e,r,function(e){var t,n=a()[r];if(n){var o=s();try{var i=k.a.L(arguments);i.unshift(l),t=n.apply(l,i)}finally{!0!==t&&(e.preventDefault?e.preventDefault():e.returnValue=!1)}!1===o[r+"Bubble"]&&(e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation())}})}()}},k.c.foreach={Sa:function(n){return function(){var e=n(),t=k.a.ua(e);return t&&"number"!=typeof t.length?(k.a.d(e),{foreach:t.data,as:t.as,includeDestroyed:t.includeDestroyed,afterAdd:t.afterAdd,beforeRemove:t.beforeRemove,afterRender:t.afterRender,beforeMove:t.beforeMove,afterMove:t.afterMove,templateEngine:k.C.oa}):{foreach:e,templateEngine:k.C.oa}}},init:function(e,t){return k.c.template.init(e,k.c.foreach.Sa(t))},update:function(e,t,n,o,i){return k.c.template.update(e,k.c.foreach.Sa(t),n,o,i)}},k.g.Q.foreach=!1,k.e.I.foreach=!0,k.c.hasfocus={init:function(n,o,i){function e(e){n.__ko_hasfocusUpdating=!0;var t=n.ownerDocument;"activeElement"in t&&(e=t.activeElement===n),t=o(),k.g.ea(t,i,"hasfocus",e,!0),n.__ko_hasfocusUpdating=!1}var t=e.bind(I,!0),r=e.bind(I,!1);k.a.n(n,"focus",t),k.a.n(n,"focusin",t),k.a.n(n,"blur",r),k.a.n(n,"focusout",r)},update:function(e,t){var n=k.a.d(t());e.__ko_hasfocusUpdating||(n?e.focus():e.blur(),k.r.K(k.a.Ba,I,[e,n?"focusin":"focusout"]))}},k.c.html={init:function(){return{controlsDescendantBindings:!0}},update:function(e,t){k.a.ca(e,t())}};var R="__ko_withIfBindingData";t("if"),t("ifnot",!1,!0),t("with",!0,!1,function(e,t){return e.createChildContext(t)}),k.c.options={update:function(e,t,n){"select"!==k.a.u(e)&&P(Error("options binding applies only to SELECT elements"));for(var o=0==e.length,i=k.a.V(k.a.fa(e.childNodes,function(e){return e.tagName&&"option"===k.a.u(e)&&e.selected}),function(e){return k.k.q(e)||e.innerText||e.textContent}),r=e.scrollTop,a=k.a.d(t());0<e.length;)k.A(e.options[0]),e.remove(0);if(a){var s=(n=n()).optionsIncludeDestroyed;if("number"!=typeof a.length&&(a=[a]),n.optionsCaption){var l=j.createElement("option");k.a.ca(l,n.optionsCaption),k.k.T(l,U),e.appendChild(l)}t=0;for(var c=a.length;t<c;t++){var u=a[t];if(!u||!u._destroy||s){l=j.createElement("option");var p=function(e,t,n){var o=typeof t;return"function"==o?t(e):"string"==o?e[t]:n},d=p(u,n.optionsValue,u);k.k.T(l,k.a.d(d)),u=p(u,n.optionsText,d),k.a.cb(l,u),e.appendChild(l)}}for(t=s=0,c=(a=e.getElementsByTagName("option")).length;t<c;t++)0<=k.a.i(i,k.k.q(a[t]))&&(k.a.bb(a[t],!0),s++);e.scrollTop=r,o&&"value"in n&&b(e,k.a.ua(n.value),!0),k.a.ub(e)}}},k.c.options.sa="__ko.optionValueDomData__",k.c.selectedOptions={init:function(n,o,i){k.a.n(n,"change",function(){var e=o(),t=[];k.a.o(n.getElementsByTagName("option"),function(e){e.selected&&t.push(k.k.q(e))}),k.g.ea(e,i,"value",t)})},update:function(e,t){"select"!=k.a.u(e)&&P(Error("values binding applies only to SELECT elements"));var n=k.a.d(t());n&&"number"==typeof n.length&&k.a.o(e.getElementsByTagName("option"),function(e){var t=0<=k.a.i(n,k.k.q(e));k.a.bb(e,t)})}},k.c.style={update:function(e,t){var n,o=k.a.d(t()||{});for(n in o)if("string"==typeof n){var i=k.a.d(o[n]);e.style[n]=i||""}}},k.c.submit={init:function(o,i,e,r){"function"!=typeof i()&&P(Error("The value for a submit binding must be a function")),k.a.n(o,"submit",function(e){var t,n=i();try{t=n.call(r,o)}finally{!0!==t&&(e.preventDefault?e.preventDefault():e.returnValue=!1)}})}},k.c.text={update:function(e,t){k.a.cb(e,t())}},k.e.I.text=!0,k.c.uniqueName={init:function(e,t){if(t()){var n="ko_unique_"+ ++k.c.uniqueName.ob;k.a.ab(e,n)}}},k.c.uniqueName.ob=0,k.c.value={init:function(n,o,i){function r(){a=!1;var e=o(),t=k.k.q(n);k.g.ea(e,i,"value",t)}var e=["change"],t=i().valueUpdate,a=!1;t&&("string"==typeof t&&(t=[t]),k.a.P(e,t),e=k.a.Ga(e)),!k.a.Z||"input"!=n.tagName.toLowerCase()||"text"!=n.type||"off"==n.autocomplete||n.form&&"off"==n.form.autocomplete||-1!=k.a.i(e,"propertychange")||(k.a.n(n,"propertychange",function(){a=!0}),k.a.n(n,"blur",function(){a&&r()})),k.a.o(e,function(e){var t=r;k.a.Ob(e,"after")&&(t=function(){setTimeout(r,0)},e=e.substring(5)),k.a.n(n,e,t)})},update:function(e,t){var n="select"===k.a.u(e),o=k.a.d(t()),i=k.k.q(e),r=o!=i;0===o&&0!==i&&"0"!==i&&(r=!0),r&&((i=function(){k.k.T(e,o)})(),n&&setTimeout(i,0)),n&&0<e.length&&b(e,o,!1)}},k.c.visible={update:function(e,t){var n=k.a.d(t()),o="none"!=e.style.display;n&&!o?e.style.display="":!n&&o&&(e.style.display="none")}},k.c.click={init:function(e,t,n,o){return k.c.event.init.call(this,e,function(){var e={};return e.click=t(),e},n,o)}},k.v=function(){},k.v.prototype.renderTemplateSource=function(){P(Error("Override renderTemplateSource"))},k.v.prototype.createJavaScriptEvaluatorBlock=function(){P(Error("Override createJavaScriptEvaluatorBlock"))},k.v.prototype.makeTemplateSource=function(e,t){if("string"==typeof e){var n=(t=t||j).getElementById(e);return n||P(Error("Cannot find template with ID "+e)),new k.l.h(n)}if(1==e.nodeType||8==e.nodeType)return new k.l.O(e);P(Error("Unknown template type: "+e))},k.v.prototype.renderTemplate=function(e,t,n,o){return e=this.makeTemplateSource(e,o),this.renderTemplateSource(e,t,n)},k.v.prototype.isTemplateRewritten=function(e,t){return!1===this.allowTemplateRewriting||this.makeTemplateSource(e,t).data("isRewritten")},k.v.prototype.rewriteTemplate=function(e,t,n){t=t((e=this.makeTemplateSource(e,n)).text()),e.text(t),e.data("isRewritten",!0)},k.b("templateEngine",k.v);var O,Y=/(<[a-z]+\d*(\s+(?!data-bind=)[a-z0-9\-]+(=(\"[^\"]*\"|\'[^\']*\'))?)*\s+)data-bind=(["'])([\s\S]*?)\5/gi,X=/\x3c!--\s*ko\b\s*([\s\S]*?)\s*--\x3e/g;k.za={vb:function(e,t,n){t.isTemplateRewritten(e,n)||t.rewriteTemplate(e,function(e){return k.za.Gb(e,t)},n)},Gb:function(e,s){return e.replace(Y,function(e,t,n,o,i,r,a){return p(a,t,s)}).replace(X,function(e,t){return p(t,"\x3c!-- ko --\x3e",s)})},kb:function(n){return k.s.ra(function(e,t){e.nextSibling&&k.Fa(e.nextSibling,n,t)})}},k.b("__tr_ambtns",k.za.kb),k.l={},k.l.h=function(e){this.h=e},k.l.h.prototype.text=function(){var e="script"===(e=k.a.u(this.h))?"text":"textarea"===e?"value":"innerHTML";if(0==arguments.length)return this.h[e];var t=arguments[0];"innerHTML"===e?k.a.ca(this.h,t):this.h[e]=t},k.l.h.prototype.data=function(e){if(1===arguments.length)return k.a.f.get(this.h,"templateSourceData_"+e);k.a.f.set(this.h,"templateSourceData_"+e,arguments[1])},k.l.O=function(e){this.h=e},k.l.O.prototype=new k.l.h,k.l.O.prototype.text=function(){if(0==arguments.length){var e=k.a.f.get(this.h,"__ko_anon_template__")||{};return e.Aa===U&&e.ia&&(e.Aa=e.ia.innerHTML),e.Aa}k.a.f.set(this.h,"__ko_anon_template__",{Aa:arguments[0]})},k.l.h.prototype.nodes=function(){if(0==arguments.length)return(k.a.f.get(this.h,"__ko_anon_template__")||{}).ia;k.a.f.set(this.h,"__ko_anon_template__",{ia:arguments[0]})},k.b("templateSources",k.l),k.b("templateSources.domElement",k.l.h),k.b("templateSources.anonymousTemplate",k.l.O),k.wa=function(e){e!=U&&!(e instanceof k.v)&&P(Error("templateEngine must inherit from ko.templateEngine")),O=e},k.va=function(n,o,i,r,a){if(((i=i||{}).templateEngine||O)==U&&P(Error("Set a template engine before calling renderTemplate")),a=a||"replaceChildren",r){var s=l(r);return k.j(function(){var e=o&&o instanceof k.z?o:new k.z(k.a.d(o)),t="function"==typeof n?n(e.$data,e):n;e=c(r,a,t,e,i);"replaceNode"==a&&(s=l(r=e))},I,{Ka:function(){return!s||!k.a.X(s)},W:s&&"replaceNode"==a?s.parentNode:s})}return k.s.ra(function(e){k.va(n,o,i,e,"replaceNode")})},k.Mb=function(o,t,i,n,r){function a(e,t){u(t,l),i.afterRender&&i.afterRender(t,e)}function s(e,t){(l=r.createChildContext(k.a.d(e),i.as)).$index=t;var n="function"==typeof o?o(e,l):o;return c(I,"ignoreTargetNode",n,l,i)}var l;return k.j(function(){var e=k.a.d(t)||[];void 0===e.length&&(e=[e]),e=k.a.fa(e,function(e){return i.includeDestroyed||e===U||e===I||!k.a.d(e._destroy)}),k.r.K(k.a.$a,I,[n,e,s,i,a])},I,{W:n})},k.c.template={init:function(e,t){var n=k.a.d(t());return"string"==typeof n||n.name||1!=e.nodeType&&8!=e.nodeType||(n=1==e.nodeType?e.childNodes:k.e.childNodes(e),n=k.a.Hb(n),new k.l.O(e).nodes(n)),{controlsDescendantBindings:!0}},update:function(e,t,n,o,i){t=k.a.d(t()),n={},o=!0;var r,a=I;"string"!=typeof t&&(t=(n=t).name,"if"in n&&(o=k.a.d(n.if)),o&&"ifnot"in n&&(o=!k.a.d(n.ifnot)),r=k.a.d(n.data)),"foreach"in n?a=k.Mb(t||e,o&&n.foreach||[],n,e,i):o?(i="data"in n?i.createChildContext(r,n.as):i,a=k.va(t||e,i,n,e)):k.e.Y(e),i=a,(r=k.a.f.get(e,"__ko__templateComputedDomDataKey__"))&&"function"==typeof r.B&&r.B(),k.a.f.set(e,"__ko__templateComputedDomDataKey__",i&&i.pa()?i:U)}},k.g.Q.template=function(e){return 1==(e=k.g.aa(e)).length&&e[0].unknown||k.g.Eb(e,"name")?I:"This template engine does not support anonymous templates nested within its templates"},k.e.I.template=!0,k.b("setTemplateEngine",k.wa),k.b("renderTemplate",k.va),k.a.Ja=function(e,t,n){return t=t||[],(e=e||[]).length<=t.length?o(e,t,"added","deleted",n):o(t,e,"deleted","added",n)},k.b("utils.compareArrays",k.a.Ja),k.a.$a=function(e,t,n,o,i){function r(e,t){g=l[t],f!==t&&(y[e]=g),g.na(f++),_(g.M),p.push(g),m.push(g)}function a(t,n){if(t)for(var o=0,e=n.length;o<e;o++)n[o]&&k.a.o(n[o].M,function(e){t(e,o,n[o].U)})}t=t||[],o=o||{};var s=k.a.f.get(e,"setDomNodeChildrenFromArrayMapping_lastMappingResult")===U,l=k.a.f.get(e,"setDomNodeChildrenFromArrayMapping_lastMappingResult")||[],c=k.a.V(l,function(e){return e.U}),u=k.a.Ja(c,t),p=[],d=0,f=0,h=[],m=[];t=[];for(var g,v,b,y=[],w=(c=[],0);v=u[w];w++)switch(b=v.moved,v.status){case"deleted":b===U&&((g=l[d]).j&&g.j.B(),h.push.apply(h,_(g.M)),o.beforeRemove&&(t[w]=g,m.push(g))),d++;break;case"retained":r(w,d++);break;case"added":b!==U?r(w,b):(g={U:v.value,na:k.m(f++)},p.push(g),m.push(g),s||(c[w]=g))}a(o.beforeMove,y),k.a.o(h,o.beforeRemove?k.A:k.removeNode);var x;for(w=0,s=k.e.firstChild(e);g=m[w];w++){for(g.M||k.a.extend(g,S(e,n,g.U,i,g.na)),d=0;u=g.M[d];s=u.nextSibling,x=u,d++)u!==s&&k.e.Pa(e,u,x);!g.Ab&&i&&(i(g.U,g.M,g.na),g.Ab=!0)}a(o.beforeRemove,t),a(o.afterMove,y),a(o.afterAdd,c),k.a.f.set(e,"setDomNodeChildrenFromArrayMapping_lastMappingResult",p)},k.b("utils.setDomNodeChildrenFromArrayMapping",k.a.$a),k.C=function(){this.allowTemplateRewriting=!1},k.C.prototype=new k.v,k.C.prototype.renderTemplateSource=function(e){var t=k.a.Z<9||!e.nodes?I:e.nodes();return t?k.a.L(t.cloneNode(!0).childNodes):(e=e.text(),k.a.ta(e))},k.C.oa=new k.C,k.wa(k.C.oa),k.b("nativeTemplateEngine",k.C),k.qa=function(){var i=this.Db=function(){if(void 0===F||!F.tmpl)return 0;try{if(0<=F.tmpl.tag.tmpl.open.toString().indexOf("__"))return 2}catch(e){}return 1}();this.renderTemplateSource=function(e,t,n){n=n||{},i<2&&P(Error("Your version of jQuery.tmpl is too old. Please upgrade to jQuery.tmpl 1.0.0pre or later."));var o=e.data("precompiled");return o||(o=e.text()||"",o=F.template(I,"{{ko_with $item.koBindingContext}}"+o+"{{/ko_with}}"),e.data("precompiled",o)),e=[t.$data],t=F.extend({koBindingContext:t},n.templateOptions),(t=F.tmpl(o,e,t)).appendTo(j.createElement("div")),F.fragments={},t},this.createJavaScriptEvaluatorBlock=function(e){return"{{ko_code ((function() { return "+e+" })()) }}"},this.addTemplate=function(e,t){j.write("<script type='text/html' id='"+e+"'>"+t+"<\/script>")},0<i&&(F.tmpl.tag.ko_code={open:"__.push($1 || '');"},F.tmpl.tag.ko_with={open:"with($1) {",close:"} "})},k.qa.prototype=new k.v,0<(e=new k.qa).Db&&k.wa(e),k.b("jqueryTmplTemplateEngine",k.qa)}"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?e(module.exports||exports):"function"==typeof define&&define.amd?define(["exports"],e):e(L.ko={})}(),function(){function nop(){}function flinger(e,t){throw e+":\n"+t}function Loader(){this.reset()}Loader.prototype={bypassCache:!1,strict:!0,queue:[],cache:{},_collect:function(e){return"object"!=typeof e&&(e={url:e||"",success:arguments[1],error:arguments[2]}),"function"!=typeof e.success&&(e.success=nop),"function"!=typeof e.error&&(e.error=this.strict?flinger:nop),e.url+="",this.bypassCache&&(e.url+="&?"[+!~url.indexOf("?")]+Math.random()),e},_imageTransport:function(t){var n=this,o=new Image;return++n.requests,o.src=t.url,o.onload=o.onerror=function(e){"load"===e.type?t.success(o,t.url):t.error("Failed to load image",t.url),n._progress()},o},_ajaxTransport:function(e){var t,n=this;return++n.requests,(t=new XMLHttpRequest).open("get",e.url,!0),t.onreadystatechange=function(){4===t.readyState&&("2"===t.status.toString().charAt()?(e.result=t[e.type||"responseText"],e.success(e.result,e.url)):e.error("Failed to load resource",e.url),n._progress())},t.send(),e},_progress:function(){if(this.trigger(this.onprogress,[++this.completed,this.requests]),this.completed===this.requests){var e=this.onready;this.reset(),this.trigger(e)}},image:function(e,t,n){var o=this._collect(e,t,n);return o.method="image",this._imageTransport(o)},text:function(e,t,n){var o=this._collect(e,t,n);return o.method="text",this._ajaxTransport(o)},json:function(e,t,n){var o=this._collect(e,t,n);return o.method="json",o.type="responseText",t=o.success,o.success=function(e){try{o.raw=e,o.result=JSON.parse(e)}catch(e){return o.error(e,o.url)}t(o.result,o.url)},this._ajaxTransport(o)},xml:function(e,t,n){var o=this._collect(e,t,n);return o.method="xml",o.type="responseXML",t=o.success,o.success=function(e){try{o.raw=e,o.result=Loader.serialize(e.documentElement)}catch(e){return o.error(e,o.url)}t(o.result,o.url)},this._ajaxTransport(o)},reset:function(){this.requests=0,this.completed=0,this.onprogress=[],this.onready=[]},trigger:function(e,t){e.some(function(e){e.apply(null,t||[])})},progress:function(e){"function"==typeof e&&this.onprogress.push(e)},ready:function(e){"function"==typeof e&&this.onready.push(e)}};var rbuiltin=/^(true|false|null)$/i,rtrim=/^\s+|\s+$/g;function parseNode(e,t){var n,o,i;switch(e.nodeType){case Node.ATTRIBUTE_NODE:return t[e.name]=evaluateString(e.value),1;case Node.ELEMENT_NODE:return o=t[n=e.nodeName],i=Loader.serialize(e),t[n]=o?o instanceof Array?o.concat(i):[o,i]:i,1;case Node.TEXT_NODE:return(i=(o=e.textContent||e.text||"").replace(rtrim,""))&&(t.text=t.text?t.text+i:i),0}return 0}function evaluateString(text){return text=((text||"")+"").replace(rtrim,""),rbuiltin.test(text)?eval(text):text}Loader.serialize=function(e){var t,n,o={},i=0;for(t=0,n=e.attributes.length;t<n;t++)i+=parseNode(e.attributes[t],o);for(t=0,n=e.childNodes.length;t<n;t++)i+=parseNode(e.childNodes[t],o);return i?o:evaluateString(e.textContent||e.text)},window.Loader=Loader}(),function(){var t=window.requestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(e){return setTimeout(e,17,+new Date+17)};function n(e){navigation.glide?(navigation.timer=t(n),navigation.glideMove()):delete navigation.timer}function u(e,t){return new o(e,t)}function o(e,t){this.x=e,this.y=t}function i(){}o.prototype={constructor:o,get length(){return Math.sqrt(this.x*this.x+this.y*this.y)},vsub:function(e){return new o(this.x-e.x,this.y-e.y)},vadd:function(e){return new o(this.x+e.x,this.y+e.y)},vdiv:function(e){return new o(this.x/e.x,this.y/e.y)},vmul:function(e){return new o(this.x*e.x,this.y*e.y)},ssub:function(e){return new o(this.x-e,this.y-e)},sadd:function(e){return new o(this.x+e,this.y+e)},sdiv:function(e){return new o(this.x/e,this.y/e)},smul:function(e){return new o(this.x*e,this.y*e)},vrot:function(e){return new o(this.x*e.x+this.y*e.y,-this.x*e.y+this.y*e.x)},srot:function(e){return new o(this.x*Math.cos(e)-this.y*Math.sin(e),this.x*Math.sin(e)+this.y*Math.cos(e))},sub:function(e){return e instanceof o?this.vsub(e):this.ssub(e)},add:function(e){return e instanceof o?this.vadd(e):this.sadd(e)},div:function(e){return e instanceof o?this.vdiv(e):this.sdiv(e)},mul:function(e){return e instanceof o?this.vmul(e):this.smul(e)},rot:function(e){return e instanceof o?this.vrot(e):this.srot(e)},sum:function(){return this.x+this.y},toString:function(){return"("+this.x+","+this.y+")"}},window.navigation={position:u(.4,.6),min:u(0,0),max:u(1,1),axis:u(1,0),accel:.92,reset:300,weight:50,frames:[],addFrame:function(e){var t=new i;return t.dimension=u(e[0],e[1]),this.frames.push(t),t},_resize:function(e){this.size=e,this.offset=e.div(2).length,this.position=this._bound(this.position),this.frames.some(function(e){e._resize(this.size),e._set(this.position)},this)},glideStart:function(e){var t=Date.now()-e.start,n=this.position.sub(e.position).div(t).mul(this.weight);t&&t<this.reset&&this._glide(n)},glideMove:function(){var e=(Date.now()-this.glide.start)/(1e3/60),t=this.table[0|e]+Math.pow(this.accel,e),n=this.glide.momentum.mul(t);e>=this.table.length||n.length<1e-4?delete this.glide:this.move(this.glide.position.add(n))},_glide:function(e){this.glide={start:Date.now(),position:this.position,momentum:e},this.timer||(this.timer=t(n))},setAcceleration:function(e){this.table=[];for(var t=0,n=0;t<e;t++)this.table[t]=n+=Math.pow(this.accel,t);this.accelPrecisionLimit=this.table[this.table.length-1]},_bound:function(e){var t=e.rot(this.axis),n=u(0,1).mul(this.offset),o=u(this.axis.x,-this.axis.y),i=this.max.sub(n),r=this.min.add(n),a=Math.min(i.x,Math.max(r.x,t.x)),s=Math.min(i.y,Math.max(r.y,t.y));return(s<r.y||s>i.y)&&(s=(r.y+i.y)/2),u(a,s).rot(o)},move:function(e,t){var n=this._bound(e),o=n.sub(this.position);t?this._glide(o.div(this.accelPrecisionLimit)):(this.position=n,this.frames.some(function(e){e._set(n)}))}},navigation.setAcceleration(150),i.prototype={scaleMax:2,scaleMin:1,scale:1,move:function(e,t,n){delete navigation.glide,navigation.move(u(e,t).mul(this.scale).div(this.dimension),n)},grip:function(e,t){delete navigation.glide,this.drag={start:Date.now(),position:navigation.position,point:u(e,t)}},pull:function(e,t,n){if(this.drag){var o=u(e,t).sub(this.drag.point).div(this.dimension),i=n?this.drag.position.sub(o):this.drag.position.add(o);navigation.move(i),Date.now()-this.drag.start>navigation.reset&&this.grip(e,t)}},free:function(e,t,n){this.drag&&(n&&navigation.glideStart(this.drag),delete this.drag)},capture:function(e,t,n,o){delete this.drag;var i=u(e,t),r=u(n,o);this.lastScale=this.scale,this.length=r.sub(i).length},stretch:function(e,t,n,o){var i=u(e,t),r=u(n,o).sub(i).length;this.zoom(this.lastScale*r/this.length)},release:function(e,t,n,o){this.grip(e,t)},zoom:function(e){e=Math.max(this.scaleMin,Math.min(this.scaleMax,e)),this.dimension=this.dimension.div(this.scale).mul(e),this.scale=e,navigation._resize(this.size.div(this.dimension)),this._set(navigation.position)},resize:function(e,t){navigation._resize(u(e,t).div(this.dimension),this)},bounds:function(e,t,n){var o=u(e[0],e[1]).div(this.dimension),i=u(t[0],t[1]).div(this.dimension),r=i.sub(o),a=r.div(r.length),s=u(0,.5).mul(n).div(this.dimension),l=o.rot(a).sub(s),c=i.rot(a).add(s);navigation.axis=a,navigation.min=u(Math.min(l.x,c.x),Math.min(l.y,c.y)),navigation.max=u(Math.max(l.x,c.x),Math.max(l.y,c.y))},updatePosition:function(e,t){},updateSize:function(e,t){},_resize:function(e){this.size=e.mul(this.dimension),this.updateSize(this.size.x,this.size.y)},_set:function(e){this.position=e.mul(this.dimension),this.center=this.position.sub(this.size.div(2)),this.updatePosition(this.center.x,this.center.y,this.scale)}}}(),function(){var s=window.model={info:SEATS_INFO_URL,locfile:LOCALE_URL,config:CONFIG_URL.replace(".xml",".json"),backup:{},onready:[],pixel:new Image,_expose:function(t){return function(e){s[t]=e}},loadConfig:function(i){s.get=new Loader,s.get.json(s.config,s._expose("planes")),s.get.xml(s.locfile,s._expose("locale")),s.get.xml(s.info,s._expose("ticket")),s.get.ready(function(){if("ERROR"in s.ticket){var e=s.locale.error.select("code",s.ticket.ERROR);i(e)}else{var t=decodeURIComponent(REGISTRATION_NUMBER),n=C.DEMO?t:s.ticket[Const.tripInfoTag][Const.typeTag]||t,o=s.planes.planes.select("uid",n);o?s.loadModel(o):i(new Error(n+" is not a valid tour id"))}})},loadModel:function(e){s.airline=e.airline?e.airline:/^EK/.test(e.uid)?"emirates":/^QR/.test(e.uid)?"qatar":"transaero",s.name=e.model,s.get.json(BASE_URL+e.config,s._expose("struct")),s.get.ready(s.processData)},processData:function(){s.home=BASE_URL+"resources/"+s.struct.path,s.struct.seats.some(function(e){e.sid=e.type,e.num=e.name.toUpperCase(),e.ref=s.planes.seat_types[e.sid].img.ref}),[].concat(s.struct.map.color,s.struct.map.gray,s.struct.masks,s.struct.seats).some(function(e){e.sprite=s.struct.sprite.info[e.ref]}),s.pixel.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAAXNSR0IArs4c6QAAAAtJREFUCB1jYGAAAAADAAFPSAqvAAAAAElFTkSuQmCC",s.struct.plane.decks.some(s.collectDeckTiles),s.downloadImages(s.struct),s.collectBoardInfo(),s.applyTRS(s.ticket)},applyTRS:function(e){var t=[].concat(e.PASSENGERS.PASSENGER),i=Object.keys(s.planes.seat_types),r=[];s.group_ticket=e.PASSENGERS.GROUPBOARDINGPASS,t.some(function(e){e.IS_INF&&(e.parent=t.select("ID",e.PARENTID),e.parent.child=e)}),s.users=t.map(function(e,t){var n={id:e.ID,age:+e.AGE,sex:e.SEX.toLowerCase(),disabled:e.DISABLED&&e.DISABLED.MESSAGE||"",message:e.MESSAGE,title:e.TITLE,ticket:e.BOARDINGPASS,error:e.ERROR,sc:e.SC,parent:e.parent,child:e.child,name:(e.NAME+" "+e.SURNAME).toLowerCase(),fclass:s.locale["flightClass"+e.SC]||"n/a",curseat:"",face:{}},o=e.CURSEAT?e.CURSEAT.toUpperCase():"";return o&&(~r.indexOf(o)?console.warn("Passenger #"+t+" has seat "+o+" already taken by other passenger, voiding"):(n.curseat=o,r.push(o))),i.map(function(e){n.face[e]=s.selectPassenger(e,n)}),C.DEMO&&(n.curseat=""),n}),s.users.some(function(e){e.parent&&(e.parent=s.users.select("id",e.parent.ID)),e.child&&(e.child=s.users.select("id",e.child.ID))}),e.SEATS.SEAT.forEach(function(e){var t=s.struct.seats.select("num",e.no.toUpperCase());if(t){var n={child:!rand(20),age:rand(100),sex:"mf"[rand(2)]},o=t.back||s.selectPassenger(t.sid,n),i="*"===e.status,r=s.users.select("curseat",t.num),a=C.DEMO?null:r?r.face[t.sid]:i?null:o;t.user=a,t.back=o,t.sc=e.sc}}),s.users.forEach(function(e){!s.struct.seats.select("num",e.curseat)&&e.curseat&&(console.warn("Passenger has seat "+e.curseat+", absent in JSON struct, voiding"),e.curseat="")})},seatRequest:function(n,o){var e=s.users.map(function(e){var t=e.curseat().toUpperCase();if(t)return["n"+e.id,t].map(encodeURIComponent).join("=")}).filter(Boolean).concat("platform=html5").join("&"),t=~SEAT_REQUEST.indexOf("?")?"&":"?";s.get.xml(SEAT_REQUEST+t+e,function(e){if("ERROR"in e){var t=s.locale.error.select("code",e.ERROR);o(t?t.message:"Unknown error")}else s.compareTRS(e),s.applyTRS(e),n({head:s.locale.resultsPopupHeader.replace("__val__",e[Const.tripInfoTag][Const.typeTag]),body:s.locale.resultsPopupText1})},function(){var e=s.locale.error.select("code",0);o(e.message)})},compareTRS:function(e){[].concat(e.PASSENGERS.PASSENGER).some(function(e){var t=s.users.select("id",e.ID);if(t){var n=t.curseat()&&t.curseat().toUpperCase(),o=e.CURSEAT&&e.CURSEAT.toUpperCase();n&&!o?e.ERROR=s.locale.registrationErrorText1.replace("__val__",n):n!==o&&(e.ERROR=s.locale.registrationErrorText2.replace("__val__",n).replace("__val__",o))}else console.log("this shouldn't happen")})},selectPassenger:function(e,t){var n=s.planes.seat_types[e];return crowd=n.people.filter(function(e){return!!t.child==e.child&&t.sex==e.sex&&t.age>=e.age[0]&&t.age<=e.age[1]}),image=crowd[rand(crowd.length)],s.struct.sprite.info[image.ref]},collectBoardInfo:function(){var e=s.ticket[Const.tripInfoTag];s.boardinfo={name:s.name,date:e.DATE,num:e.NUM,boardnum:e[Const.typeTag],boarding_time:e[Const.boardingTimeTag],takeoff_time:e[Const.depatureTimeTag],from:{port:e.AIRP_FROM?"("+e.AIRP_FROM+")":"",port_rus:e[Const.depatureCityTag],city:e.AIRPCITYEN_FROM},to:{port:e.AIRP_TO?"("+e.AIRP_TO+")":"",port_rus:e[Const.arrivalCityTag],city:e.AIRPCITYEN_TO}}},collectDeckTiles:function(e){if(e.huge){var n=e.url.split(/%(\d\d)d/),o=parseInt(n[1],10),t=e.tiles[0]*e.tiles[1];e.parts=Array(t).join().split(",").map(function(e,t){return{_url:s.home+n[0]+t.toDigits(o)+n[2]}}),e.load=!1}},downloadImages:function(e){var i={};function r(t,e){i[e].some(function(e){e.width=t.width,e.height=t.height,e.image=t})}function a(e,t){i[t].some(function(e){e.width=s.pixel.width,e.height=s.pixel.height,e.image=s.pixel}),console.log(e,t)}!function e(t){var n,o;for(n in t)(n=t[n])&&"object"==typeof n&&((o=n.url||n.src)&&!1!==n.load?(o=s.home+o,i[o]?i[o].push(n):(i[o]=[n],s.get.image(o,r,a))):e(n))}(e),s.get.progress(s.resourcesProgress),s.get.ready(s.resourcesLoaded)},makeSpritePart:function(e){var t=document.createElement("canvas");return t.width=e.w,t.height=e.h,t.getContext("2d").drawImage(s.struct.sprite.image,e.x,e.y,e.w,e.h,0,0,e.w,e.h),t},makeImageCanvas:function(e){var t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0),t},resourcesProgress:function(){},resourcesLoaded:function(){}}}(),setTimeout(function(e){var o=setTimeout;e||(setTimeout=function(e,t){var n=[].slice.call(arguments,2);return o(function(){e.apply(null,n)},t)})},0,!0),function(n,o){function e(e){e=e.touches?e.touches[0]:e,n=e.pageX,o=e.pageY}function t(e){if(e=e.changedTouches?e.changedTouches[0]:e,n=Math.abs(e.pageX-n),o=Math.abs(e.pageY-o),n<3&&o<3){var t=document.createEvent("CustomEvent");t.initCustomEvent("tap",!0,!0,e),e.target.dispatchEvent(t)}}document.addEventListener("mousedown",e,!0),document.addEventListener("mouseup",t,!0),document.addEventListener("touchstart",e,!0),document.addEventListener("touchend",t,!0)}(),Object.defineProperty(Number.prototype,"toDigits",{value:function(e){var t=(this+"").length;return Array(Math.max(e,t-1)-t+1).join("0")+this}}),Object.defineProperty(Number.prototype,"px",{get:function(){return this+"px"}}),Object.defineProperty(Object.prototype,"copy",{value:function(){return[].slice.call(arguments).some(function(e){if(e&&"object"==typeof e)for(var t in e)this[t]=e[t]},this),this}}),Object.defineProperty(Array.prototype,"select",{value:function(e,t){for(var n=0,o=this.length;n<o;n++)if(this[n]&&this[n][e]==t)return this[n]}}),Object.defineProperty(Array.prototype,"group",{value:function(e,t){for(var n,o=[],i=-1,r=this.length;++i<r;)n=e.call(t,this[i],i,this),isNaN(n)&&(n=0),o[n]||(o[n]=[]),o[n].push(this[i]);return o}});var seats,decks,groups,masks,map,tiles,frames={},cookie={},params={},debug={enabled:!1,token:'Hx""$$#(073635',mouse:{},scale:1,hotkey:function(e){if(debug.enabled)switch(String.fromCharCode(e.keyCode)){case"0":navigation.move(0);break;case"1":navigation.move(1);break;case"+":frames.view.zoom(debug.scale+=.2);break;case"-":frames.view.zoom(debug.scale-=.2)}},hover:function(e){var t=this.hover.previous;this.enabled&&t!==e&&(el.plane.style.cursor=e?"pointer":"default",t&&t.hover(!1),e&&e.hover(!0),this.hover.previous=e)},mousedown:function(e){debug.enabled&&(debug.mouse.down=!0,debug.mouse.sx=e.pageX,debug.mouse.sy=e.pageY)},mousemove:function(e){if(debug.enabled){var t=Seat.findByPosition(e.offsetX,e.offsetY);debug.hover(t),debug.mouse.down&&(debug.mouse.dx=e.pageX-debug.mouse.sx,debug.mouse.dy=e.pageY-debug.mouse.sy)}},mouseup:function(e){debug.enabled&&(debug.mouse.down=!1)}},view={loading:"",orient:"",decker:"",upper:!1,user:null,passengers_visible:!1,small:!1,lower_deck_class:"",upper_deck_class:"",show_popup_helper:!1,group_ticket:"",debug:{pos_nav:0,pos_view:0},plane:{width:0,height:0}},el={view:".view",plane:".plane",nav:".nav",logo:".airline-logo",nav_logo:".airline-logo-small",frame:".frame",fly:".fly",result:".popup.done",error:".popup.fail",progress:".background .caption",current:".selection",label:".selection .label"},C={GROUP_SIZE:38,PROGRESS_FAKE:.4,DEBUG:!1,DEMO:!1};function store_pair(e){this[(e=e.split("="))[0]]=e[1]}function ready(){for(var e in el)el[e]=document.querySelector(el[e]);!function e(t){for(var n in t)"function"==typeof t[n]||(t[n]&&"object"==typeof t[n]?e(t[n]):t[n]=ko.observable(t[n]))}(view),el.sound=document.createElement("audio"),el.sound.src=BASE_URL+"click.mp3",el.sound.load(),C.DEMO=!!params.demo,debug.enabled=hash(params.debug)===debug.token,document.body.style.display="block",model.loadConfig(function(e){clearInterval(o.interval),el.progress.textContent=e.message}),model.resourcesProgress=n,model.resourcesLoaded=function(){clearInterval(o.interval),el.progress.textContent="...",start()};var t=new Date;function n(e,t){n.real=e/t,o()}function o(){var e=n.real*(1-C.PROGRESS_FAKE)+n.fake;el.progress.textContent=(100*e|0)+"%"}n.fake=n.real=0,o.interval=setInterval(function(){n.fake=Math.min(C.PROGRESS_FAKE,(new Date-t)/1e3*.01),o()},1e3/60)}function start(){function n(e,t){return t/C.GROUP_SIZE|0}decks=model.struct.plane.decks.map(make(Deck)),masks=model.struct.masks.map(make(Mask)),seats=model.struct.seats.map(make(Seat)).sort(numeric("y")),map=new Map(model.struct.map.gray,model.struct.map.color);var o=[-.46,.89];groups=(groups=seats.slice().sort(function(e,t){return(e.x-t.x)*o[0]+(e.y-t.y)*o[1]}).group(function(e,t){return 1<e.deck?1:0}).map(function(e,t){return e.group(n)}))[0].concat(groups[1]||[]).map(make(SeatGroup)),(tiles=[].concat.apply([],decks.map(property("tiles"))).concat(groups,masks)).some(function(e){e.p=decks[e.d].elem}),C.DEMO?add_class(el.logo,"static-"+model.airline):add_class(el.nav_logo,"static-"+model.airline+"-small"),setup_viewmodel(),update_users(model.users),model.struct.double_decker&&view.hide_upper_deck(),setup_navigation(),resize(),register_events(),frames.view.zoom(view.small()?.5:1),view.users().forEach(function(e){Seat.link(e,seats.select("num",e.curseat()))}),groups.some(method("draw")),load_session(),view.loading("done"),setTimeout(view.loading,500,"void")}function getPathImage(e,t){var n=document.createElement("canvas");return n.height=t.h,n.width=t.w,n.getContext("2d").drawImage(e,t.x,t.y,t.w,t.h,0,0,n.width,n.height),n.toDataURL()}function load_session(){var e=view.users(),t=e.filter(function(e){if(!e.curseat()&&!e.parent&&!e.disabled)return e});if(t.length)view.selectUser(t[0]);else{var n=e.filter(function(e){if(!e.parent&&!e.disabled)return e});n.length?view.selectUser(n[0]):console.log("all users disabled")}view.save_session=ko.computed(function(){var e="; expires="+new Date(1728e5+new Date);document.cookie="tour="+encodeURIComponent(SEATS_INFO_URL)+e,document.cookie="index="+view.users().indexOf(view.user())+e,document.cookie="seats="+view.users().map(method("curseat")).join(":")+e}),view.delete_session=function(){document.cookie="tour=; expires="+new Date(0),document.cookie="index=; expires="+new Date(0),document.cookie="seats=; expires="+new Date(0)}}function setup_viewmodel(){function n(e){if(view.upper(e),e)if(view.lower_deck_class("static-deck_ina"),view.upper_deck_class("static-deck_act selected"),rem_class(decks[1].elem,"hidden"),decks[1].huge)add_class(decks[0].elem,"hidden"),setTimeout(add_class,500,decks[0].elem,"void");else{var t=model.struct.plane.point1;frames.view.move(t[0],t[1],!0)}else view.lower_deck_class("static-deck_act selected"),view.upper_deck_class("static-deck_ina"),add_class(decks[1].elem,"hidden"),decks[1].huge&&(rem_class(decks[0].elem,"void"),setTimeout(rem_class,0,decks[0].elem,"hidden"))}document.title=model.boardinfo.name,view.show_passengers=function(){Seat.togglePassengers(!0)},view.hide_passengers=function(){Seat.togglePassengers(!1)},view.show_upper_deck=function(){n(!0)},view.hide_upper_deck=function(){n(!1)},view.click_icon_helper=function(){view.show_popup_helper(!view.show_popup_helper())},view.decker(model.struct.double_decker?"double-decker":"single-decker"),view.board=model.boardinfo,view.board.time=/(\d+?)(\d\d)$/.exec(view.board.takeoff_time).slice(1).join(":"),view.formatAirport=function(e){return e.port_rus+" "+e.port},view.users=ko.observableArray(),view.placedUsers=ko.computed(function(){return view.users().filter(function(e){return e.curseat()||e.parent&&e.parent.curseat()})},view),view.placedAllUsers=ko.computed(function(){return view.placedUsers().length==view.users().length},view),view.selectUser=function(e){if(e&&!e.parent&&!e.disabled){var t=view.user();return t&&t.selected(!1),view.user(e),e.selected(!0),t&&e.sc===t.sc||groups.some(method("draw")),e.seat&&(model.struct.double_decker&&n(1<e.seat.deck),frames.view.move(e.seat.x,e.seat.y,!0)),!0}},view.airline=ko.observable(model.airline),view.classes=ko.observableArray([view.orient,view.decker,view.airline]),debug.enabled&&view.classes.push(function(){return"debug"}),C.DEMO&&view.classes.push(function(){return"demo"}),view.list_category=ko.computed(function(){var r=[],a=[];return model.struct.seats.forEach(function(e){if(-1==r.indexOf(e.type)){r.push(e.type);var t=model.planes.seat_types[e.type],n=t.img.ref,o=model.struct.sprite.info[n],i=getPathImage(model.struct.sprite.image,o);a.push({id:e.type,boxes:o,name:t.name,imageBase64:ko.observable(i)})}}),a},view),view.root_class=ko.computed(function(){return this.classes().map(method("call")).join(" ")},view),view.display_result=ko.observable(!1),view.result_header=ko.observable(""),view.result_text=ko.observable(""),view.display_error=ko.observable(!1),view.error_message=ko.observable(""),view.confirm_caption=ko.computed(function(){return view.small()?"":""}),view.submit=function(){view.placedUsers().length&&(view.loading("done"),setTimeout(view.loading,0,"half"),model.seatRequest(view.success,view.error))},view.success=function(e){update_users(model.users),groups.some(method("draw")),view.display_result(!0),view.result_header(e.head),view.result_text(e.body),view.register_scroll.destroy(),view.register_scroll=new iScroll("confirm-users")},view.error=function(e){view.display_error(!0),view.error_message(e)},view.hide_error=function(){view.display_error(!1),view.loading("done"),setTimeout(view.loading,500,"void")},view.complete=function(){view.display_result(!1),view.loading("done"),view.selectUser(view.users()[0]),setTimeout(view.loading,500,"void")},ko.applyBindings(view),view.register_scroll=new iScroll("confirm-users"),view.usersbox_scroll=new iScroll("users-scroll"),setTimeout(function(){view.usersbox_scroll.refresh()})}function make_selection_label(){var e=document.createElement("div");return e.className="selection",e.innerHTML='<div class="wrap"><div data-bind="text: user.curseat" class="label"></div><svg viewBox="0 0 26 26"><path d="M0,0 L26,0 L26,18 L13,26 L0,18 L0,0" /></svg></div>',{selection:e,label:e.querySelector(".label")}}function select_next_user(){var e=view.users(),t=e.indexOf(view.user()),n=e.slice(t).concat(e.slice(0,t)).filter(not(method("curseat")));n.length&&view.selectUser(n[0])}function update_users(e){e.some(function(e){e.seat=seats.select("num",e.curseat),e.selected=ko.observable(!1),e.error=ko.observable(e.error||""),e.curseat=ko.observable(e.curseat||""),e.copy(make_selection_label())}),view.users(e),view.group_ticket(model.group_ticket)}function setup_navigation(){frames.view=navigation.addFrame(model.struct.plane.size),frames.view.updateSize=function(e,t){},frames.view.updatePosition=function(e,n,t){e=hround(e),n=hround(n),position(el.plane,-e,-n,t);var o=frames.view.size.x/t,i=frames.view.size.y/t;e/=t,n/=t,tiles.some(function(t){t.x<e+o&&t.y<n+i&&t.x+t.w>e&&t.y+t.h>n?(t.delayed&&r.image(t.url,function(e){t.delayed=!1,t.c.getContext("2d").drawImage(e,0,0)}),t.c.parentNode||t.p.appendChild(t.c)):t.c.parentNode&&t.p.removeChild(t.c)}),debug.enabled&&view.debug.pos_view("("+[e,n]+")")},frames.map=navigation.addFrame(model.struct.map.size),frames.map.updateSize=function(e,t){map.frame.style.width=(e+.5|0).px,map.frame.style.height=(t+.5|0).px},frames.map.updatePosition=function(e,t){e=hround(e),t=hround(t),position(map.frame,e,t),position(map.color,-1-e,-1-t),debug.enabled&&view.debug.pos_nav("("+[e,t]+")")};var e=model.struct.plane.point1,t=model.struct.plane.point2,r=new Loader;frames.view.bounds(e,t,820)}function resize(){var e=window.innerWidth<window.innerHeight,t=model.struct.plane,n=model.struct.map;view.small(window.innerWidth<601),view.orient(e?"portrait":"landscape"),frames.view.scaleMin=view.small()?.5:1,el.plane.style.width=t.size[0].px,el.plane.style.height=t.size[1].px,el.nav.style.width=n.size[0].px,el.nav.style.height=n.size[1].px,el.nav.style.marginLeft=(-n.size[0]/2).px,el.nav.style.marginTop=(-n.size[1]/2).px;var o=el.view.getBoundingClientRect();frames.view.resize(o.width,o.height)}function register_events(){var s="ontouchstart"in window,l={start:s?"touchstart":"mousedown",move:s?"touchmove":"mousemove",end:s?"touchend":"mouseup",click:"tap"},e=document.querySelector(".plane"),a=document.querySelector(".nav"),t=[[a,l.start,function(e){var t=s?e.touches[0]:e,n=view.small()?.5:1,o=a.getBoundingClientRect(),i=t.pageX-o.left,r=t.pageY-o.top;frames.map.move(i/n,r/n)}],[a,l.start,o],[a,l.move,o],[a,l.end,o],[e,l.start,n],[e,l.move,n],[e,l.end,n],[e,l.click,function(e){if(view.user()){var t=e.detail.changedTouches?e.detail.changedTouches[0]:e.detail,n=t.pageX+frames.view.center.x,o=t.pageY+frames.view.center.y,i=Seat.findByPosition(n/frames.view.scale,o/frames.view.scale);i&&i.take(view.user())}}],[window,"resize",resize]];function n(e){var t=e.touches,n=e.changedTouches,o=s&&t.length+(e.type===l.end?n.length:0)===2,i=e.type===l.start?o?"capture":"grip":e.type===l.move?o?"stretch":"pull":e.type===l.end?o?"release":"free":null,r=s?t[0]||{}:e,a=o?e.type===l.end?n[0]:t[1]:{pageX:!0};frames.view[i](r.pageX,r.pageY,a.pageX,a.pageY),e.preventDefault()}function o(e){var t=s?e.touches[0]||e.changedTouches[0]:e,n=view.small()?.5:1,o=t.pageX,i=t.pageY,r=e.type===l.start?"grip":e.type===l.move?"pull":e.type===l.end?"free":null;frames.map[r](o/n,i/n,!1),e.preventDefault()}debug.enabled&&t.unshift([window,"keypress",debug.hotkey],[a,l.click,debug.click_map],[e,l.start,debug.mousedown],[e,l.move,debug.mousemove],[e,l.end,debug.mouseup]),t.some(function(e){e[0].addEventListener(e[1],e[2],!1)})}function position(e,t,n,o){arguments.length<3&&(n=t.y,t=t.x);var i="translate("+[t.px,n.px]+")";3<arguments.length&&(i+=" scale("+o+")"),e.style.transform=e.style.OTransform=e.style.msTransform=e.style.mozTransform=e.style.webkitTransform=i}function click_sound(){try{el.sound.currentTime=.01}catch(e){}el.sound.play()}function Tile(e){}function Map(e,t){this.gray=e.image||model.makeSpritePart(e.sprite),this.color=t.image||model.makeSpritePart(t.sprite),this.frame=el.frame,el.nav.appendChild(this.gray),el.frame.appendChild(this.color)}function Mask(e,t){this.set(model.makeSpritePart(e.sprite)).pos(e.x,e.y).put((e.deck||1)-1),this.c.className="mask",this.c.style.zIndex=t+101}function Deck(a,s,e){if(this.elem=document.createElement("div"),this.elem.className="deck",this.huge=a.huge,this.huge)this.back=model.makeImageCanvas(a.thumb.image),this.back.className="background",this.elem.appendChild(this.back),this.tiles=a.parts.map(function(e,t){var n,o,i=t%a.tiles[0],r=t/a.tiles[0]|0;return(n=document.createElement("canvas")).width=a.width,n.height=a.height,(o=(new Tile).set(n).pos(i*n.width,r*n.height).put(s)).delayed=!0,o.url=e._url,o},this);else{var t=(new Tile).set(model.makeImageCanvas(a.image)).pos(a.translate[0],a.translate[1]).put(s);this.tiles=[t]}el.plane.appendChild(this.elem)}function SeatGroup(e,t){e.sort(numeric("y")).some(function(e){e.group=this},this),this.items=e,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.size=this.getDimensions(),this.deck=decks[e[0].deck-1].elem,this.canvas.className="seat",this.canvas.style.zIndex=t+1,this.canvas.style.left=this.size.left.px,this.canvas.style.top=this.size.top.px,this.canvas.width=this.size.width,this.canvas.height=this.size.height,(this.canvas.group=this).context.textAlign="center",this.context.textBaseline="middle",this.context.fillStyle="rgba(255, 255, 255, 0.7)",this.context.strokeStyle="white",this.context.lineWidth=.5,this.set(this.canvas).pos(this.size.left,this.size.top).put(e[0].deck-1)}function Seat(e){this.copy(e),this.size=[Math.max(this.sprite.offset.size[0],this.sprite.w),Math.max(this.sprite.offset.size[1],this.sprite.h)],this.deckElement=decks[this.deck-1].elem}location.search.substr(1).split("&").filter(Boolean).some(store_pair,params),document.cookie.split(/; ?/).some(store_pair,cookie),window.addEventListener("load",ready,!1),Tile.prototype={set:function(e){return this.c=e,this.w=e.width,this.h=e.height,this},pos:function(e,t){return this.x=e,this.y=t,this.c.style.left=e.px,this.c.style.top=t.px,this},put:function(e){return this.d=e,this}},Mask.prototype=new Tile,SeatGroup.prototype=new Tile,SeatGroup.prototype.draw=function(){var e=this.size,t=this.context;if(t.clearRect(0,0,e.width,e.height),debug.enabled){var n=[rand(255),rand(255),rand(255),.3];t.save(),t.fillStyle="rgba("+n+")",t.fillRect(0,0,e.width,e.height),t.restore()}this.items.some(method("draw"))},SeatGroup.prototype.getDimensions=function(){var e=this.items.map(property("x")),t=this.items.map(property("y")),n=min(e),o=min(t),i=max(e),r=max(t),a=min(this.items.map(function(e){return e.x-n-e.size[0]})),s=max(this.items.map(function(e){return e.y-r+e.size[1]}));return{left:n+a,top:o,width:i-n-a,height:r-o+s}},Seat.findByPosition=function(e,t){for(var n,o=seats.length;n=seats[--o];)if((n.match_service_class||C.DEMO)&&(!n.user||n===view.user().seat)&&(view.upper()?!n.low:n.deck<2)&&(!(1<decks.length)||Seat.findByDeck(n))&&n.contains(e,t))return n},Seat.findByDeck=function(e){var t=+view.upper(),n=e.id.substr(0,1),o=+e.id.substr(1);return e.deck==t+1||37<o||37==o&&0<=["a","b","c","d"].indexOf(n)||36==o&&0<=["a","b","c"].indexOf(n)||35==o&&0<=["a"].indexOf(n)},Seat.togglePassengers=function(t){view.passengers_visible(t),seats.some(function(e){e!==view.user().seat&&(e.user=t&&.3<Math.random()&&e.back)}),groups.some(method("draw"))},Seat.unlink=function(e){e&&e.seat&&(e.selection.parentNode&&e.selection.parentNode.removeChild(e.selection),e.seat.user=null,e.seat.group.draw(),e.seat=null,e.curseat(""))},Seat.link=function(e,t){e&&t&&(position(e.selection,t),e.label.textContent=t.num,t.deckElement.appendChild(e.selection),e.seat=t,e.curseat(t.num),t.user=e.face[t.sid],t.group.draw())},Seat.prototype={constructor:Seat,labelSize:Const.labelSize,labelTransform:Const.labelTransform,contains:function(o,i){return this.sprite.offset.areas.some(function(e){var t=o-this.x-e[0],n=i-this.y-e[1];return 0<t&&t<e[2]&&0<n&&n<e[3]},this)},updateState:function(){this.X=this.x-this.group.size.left-this.size[0],this.Y=this.y-this.group.size.top,this.match_service_class=view.user()&&this.sc===view.user().sc},draw:function(){this.updateState(),this.drawUnit(this.sprite,this.X,this.Y),debug.enabled&&(this.drawArea([-1,-1,2,2]),this.user||this.sprite.offset.areas.some(this.drawArea,this)),this.user?this.drawUnit(this.user,this.X+this.sprite.offset.user[0]+this.size[0]-this.user.w,this.Y+this.sprite.offset.user[1]):(this.match_service_class||C.DEMO)&&this.drawLabel(this.num)},drawUnit:function(e,t,n){this.group.context.drawImage(model.struct.sprite.image,e.x,e.y,e.w,e.h,t,n,e.w,e.h)},drawArea:function(e){this.group.context.strokeRect(e[0]+this.x-this.group.size.left,e[1]+this.y-this.group.size.top,e[2],e[3])},drawLabel:function(e){var t=this.group.context,n=this.labelSize;t.save(),t.fillStyle=debug.enabled&&this.over?"orangered":debug.enabled&&this.low?"crimson":this===model.taken?"#19cf00":"rgba(0,0,0,0.5)",t.translate(this.X+this.sprite.offset.label[0],this.Y+this.sprite.offset.label[1]),t.transform.apply(t,this.labelTransform),t.fillRect(0,0,n,n),t.strokeText(e,n/2,n/2),t.restore()},highlight:function(){Seat.clickTimer?(Seat.clickTimer=clearTimeout(Seat.clickTimer),add_class(el.fly,"void"),setTimeout(function(e){e.highlight()},0,this)):(position(el.fly,this.x+this.sprite.offset.center[0],this.y+this.sprite.offset.center[1]),rem_class(el.fly,"animate"),rem_class(el.fly,"void"),setTimeout(add_class,0,el.fly,"animate"),Seat.clickTimer=setTimeout(add_class,500,el.fly,"void"))},take:function(e){debug.enabled&&console.log(this);var t=e.seat===this;Seat.unlink(e),t||(Seat.link(e,this),C.DEMO||select_next_user()),this.highlight(),click_sound()},hover:function(e){this.over=!!e,this.group.draw()}};